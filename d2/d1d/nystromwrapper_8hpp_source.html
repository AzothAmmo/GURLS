<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>GURLS++: nystromwrapper.hpp Source File</title>

<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><img alt="Logo" src="../../logo.png"/></td>
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">GURLS++
   &#160;<span id="projectnumber">2.0.00</span>
   </div>
   <div id="projectbrief">C++ Implementation of GURLS Matlab Toolbox</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('d2/d1d/nystromwrapper_8hpp.html','../../');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">nystromwrapper.hpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00002"></a>00002 <span class="preprocessor">#include &quot;nystromwrapper.h&quot;</span>
<a name="l00003"></a>00003 
<a name="l00004"></a>00004 <span class="preprocessor">#include &quot;optmatrix.h&quot;</span>
<a name="l00005"></a>00005 <span class="preprocessor">#include &quot;predkerneltraintest.h&quot;</span>
<a name="l00006"></a>00006 <span class="preprocessor">#include &quot;primal.h&quot;</span>
<a name="l00007"></a>00007 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d60/utils_8h.html" title="Utility functions.">utils.h</a>&quot;</span>
<a name="l00008"></a>00008 
<a name="l00009"></a>00009 
<a name="l00010"></a>00010 <span class="preprocessor">#include &quot;macroavg.h&quot;</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &quot;precisionrecall.h&quot;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &quot;rmse.h&quot;</span>
<a name="l00013"></a>00013 
<a name="l00014"></a>00014 <span class="preprocessor">#include &lt;boost/date_time/posix_time/posix_time_types.hpp&gt;</span>
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 <span class="preprocessor">#include &lt;vector&gt;</span>
<a name="l00017"></a>00017 
<a name="l00018"></a>00018 <span class="keyword">namespace </span>gurls
<a name="l00019"></a>00019 {
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;
<a name="l00022"></a><a class="code" href="../../d2/d25/classgurls_1_1_nystrom_wrapper.html#abb41f0d0c08222fa6b303f1857bc8269">00022</a> <a class="code" href="../../d2/d25/classgurls_1_1_nystrom_wrapper.html#abb41f0d0c08222fa6b303f1857bc8269" title="Constructor.">NystromWrapper&lt;T&gt;::NystromWrapper</a>(<span class="keyword">const</span> std::string&amp; name):<a class="code" href="../../d1/db4/classgurls_1_1_kernel_wrapper.html" title="KernelWrapper is the base class for all gurls++ wrappers.">KernelWrapper</a>&lt;T&gt;(name) {}
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;
<a name="l00025"></a><a class="code" href="../../d2/d25/classgurls_1_1_nystrom_wrapper.html#a58e8f409e7893e1a5ccba74253ad4f2a">00025</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/d25/classgurls_1_1_nystrom_wrapper.html#a58e8f409e7893e1a5ccba74253ad4f2a" title="Initial parameter selection and training.">NystromWrapper&lt;T&gt;::train</a>(<span class="keyword">const</span> <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> &amp;X, <span class="keyword">const</span> <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> &amp;y)
<a name="l00026"></a>00026 {
<a name="l00027"></a>00027     <a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html" title="GurlsOptionsList is an option containing a list of options mapped by name.">GurlsOptionsList</a> *opt = this-&gt;opt;
<a name="l00028"></a>00028     <span class="keyword">const</span> <span class="keywordtype">bool</span> regression = (this-&gt;probType == <a class="code" href="../../d5/d55/classgurls_1_1_gurls_wrapper.html" title="GurlsWrapper is the base class for all gurls++ wrappers.">GurlsWrapper&lt;T&gt;::REGRESSION</a>);
<a name="l00029"></a>00029 
<a name="l00030"></a>00030     <a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html" title="GurlsOptionsList is an option containing a list of options mapped by name.">GurlsOptionsList</a>* paramsel = opt-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a1e3d2445536a446436eef89aef68a321" title="Returns a pointer to a T option mapped with a key.">getOptAs</a>&lt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html" title="GurlsOptionsList is an option containing a list of options mapped by name.">GurlsOptionsList</a>&gt;(<span class="stringliteral">&quot;paramsel&quot;</span>);
<a name="l00031"></a>00031     paramsel-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a7197b056bb30449f518a43cb564ec011" title="Removes the option mapped with a specified key.">removeOpt</a>(<span class="stringliteral">&quot;X&quot;</span>);
<a name="l00032"></a>00032     paramsel-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a7197b056bb30449f518a43cb564ec011" title="Removes the option mapped with a specified key.">removeOpt</a>(<span class="stringliteral">&quot;C&quot;</span>);
<a name="l00033"></a>00033     paramsel-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a7197b056bb30449f518a43cb564ec011" title="Removes the option mapped with a specified key.">removeOpt</a>(<span class="stringliteral">&quot;n_opt&quot;</span>);
<a name="l00034"></a>00034     paramsel-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a7197b056bb30449f518a43cb564ec011" title="Removes the option mapped with a specified key.">removeOpt</a>(<span class="stringliteral">&quot;guesses&quot;</span>);
<a name="l00035"></a>00035     paramsel-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a7197b056bb30449f518a43cb564ec011" title="Removes the option mapped with a specified key.">removeOpt</a>(<span class="stringliteral">&quot;perf&quot;</span>);
<a name="l00036"></a>00036     paramsel-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a7197b056bb30449f518a43cb564ec011" title="Removes the option mapped with a specified key.">removeOpt</a>(<span class="stringliteral">&quot;perf_train&quot;</span>);
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 
<a name="l00039"></a>00039     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> n = X.<a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html#a5ef176755f75f33e282fc1ac976958da" title="Returns the number of rows.">rows</a>();
<a name="l00040"></a>00040     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> d = X.<a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html#afa235cd07be1afe30497d55c90c42844" title="Returns the number of columns.">cols</a>();
<a name="l00041"></a>00041     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> t = y.<a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html#afa235cd07be1afe30497d55c90c42844" title="Returns the number of columns.">cols</a>();
<a name="l00042"></a>00042 
<a name="l00043"></a>00043     <span class="keyword">const</span> <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> empty;
<a name="l00044"></a>00044 
<a name="l00045"></a>00045     <span class="keyword">const</span> <span class="keywordtype">double</span> sigma = opt-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a45c4d02344b2c83c3641f4b41034e320" title="Returns a numeric option mapped with a key.">getOptAsNumber</a>(<span class="stringliteral">&quot;paramsel.sigma&quot;</span>);
<a name="l00046"></a>00046     <a class="code" href="../../d5/dac/classgurls_1_1_performance.html" title="Performance is the class that evaluates prediction performance.">Performance&lt;T&gt;</a> *perfTask = <a class="code" href="../../d5/dac/classgurls_1_1_performance.html#af45e9e3b96f97d345c8c8b8ff9e92552" title="Factory function returning a pointer to the newly created object.">Performance&lt;T&gt;::factory</a>(opt-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#ad0d2298f85d7e89e810f5234b6e85abb" title="Returns a string option mapped with a key.">getOptAsString</a>(<span class="stringliteral">&quot;hoperf&quot;</span>));
<a name="l00047"></a>00047 
<a name="l00048"></a>00048 
<a name="l00049"></a>00049     <span class="keyword">const</span> <span class="keywordtype">double</span> n_nystrom = opt-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a45c4d02344b2c83c3641f4b41034e320" title="Returns a numeric option mapped with a key.">getOptAsNumber</a>(<span class="stringliteral">&quot;n_nystrom&quot;</span>);
<a name="l00050"></a>00050     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> nparams = <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">long</span><span class="keyword">&gt;</span>(opt-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a45c4d02344b2c83c3641f4b41034e320" title="Returns a numeric option mapped with a key.">getOptAsNumber</a>(<span class="stringliteral">&quot;nlambda&quot;</span>));
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 
<a name="l00053"></a>00053     <span class="keyword">const</span> <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> *Xtr = NULL;
<a name="l00054"></a>00054     <span class="keyword">const</span> <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> *ytr = NULL;
<a name="l00055"></a>00055     <span class="keyword">const</span> <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> *Xva = NULL;
<a name="l00056"></a>00056     <span class="keyword">const</span> <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> *yva = NULL;
<a name="l00057"></a>00057 
<a name="l00058"></a>00058 
<a name="l00059"></a>00059     <span class="keywordtype">bool</span> split = (nparams &gt; 1);
<a name="l00060"></a>00060 
<a name="l00061"></a>00061     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> ntr, nva;
<a name="l00062"></a>00062 
<a name="l00063"></a>00063     <span class="keywordflow">if</span>(split)
<a name="l00064"></a>00064     {
<a name="l00065"></a>00065         ntr = <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">long</span><span class="keyword">&gt;</span>(n*(1.0-opt-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a45c4d02344b2c83c3641f4b41034e320" title="Returns a numeric option mapped with a key.">getOptAsNumber</a>(<span class="stringliteral">&quot;hoproportion&quot;</span>)));
<a name="l00066"></a>00066         nva = n-ntr;
<a name="l00067"></a>00067 
<a name="l00068"></a>00068         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>* trva = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>[n];
<a name="l00069"></a>00069         <a class="code" href="../../db/d4e/namespacegurls.html#a75f6afe3bf7f7be79d66714593f5c7bc" title="Generates a vector containing a random permutation of the values from start to start+n inclusive...">randperm</a>(n, trva, <span class="keyword">true</span>, 0);
<a name="l00070"></a>00070 
<a name="l00071"></a>00071         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *tr = trva;
<a name="l00072"></a>00072         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *va = trva+ntr;
<a name="l00073"></a>00073 
<a name="l00074"></a>00074 
<a name="l00075"></a>00075         <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> *Xtr_tmp = <span class="keyword">new</span> <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a>(ntr, d);
<a name="l00076"></a>00076         <a class="code" href="../../db/d4e/namespacegurls.html#a4015e8417bc5f4375da5524d7b67338c" title="Generates a submatrix from an input matrix.">subMatrixFromRows</a>(X.<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>(), n, d, tr, ntr, Xtr_tmp-&gt;<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>());
<a name="l00077"></a>00077         Xtr = Xtr_tmp;
<a name="l00078"></a>00078 
<a name="l00079"></a>00079         <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> *ytr_tmp = <span class="keyword">new</span> <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> (ntr, t);
<a name="l00080"></a>00080         <a class="code" href="../../db/d4e/namespacegurls.html#a4015e8417bc5f4375da5524d7b67338c" title="Generates a submatrix from an input matrix.">subMatrixFromRows</a>(y.<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>(), n, t, tr, ntr, ytr_tmp-&gt;<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>());
<a name="l00081"></a>00081         ytr = ytr_tmp;
<a name="l00082"></a>00082 
<a name="l00083"></a>00083         <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> *Xva_tmp = <span class="keyword">new</span> <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> (nva, d);
<a name="l00084"></a>00084         <a class="code" href="../../db/d4e/namespacegurls.html#a4015e8417bc5f4375da5524d7b67338c" title="Generates a submatrix from an input matrix.">subMatrixFromRows</a>(X.<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>(), n, d, va, nva, Xva_tmp-&gt;<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>());
<a name="l00085"></a>00085         Xva = Xva_tmp;
<a name="l00086"></a>00086 
<a name="l00087"></a>00087         <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> *yva_tmp = <span class="keyword">new</span> <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> (nva, t);
<a name="l00088"></a>00088         <a class="code" href="../../db/d4e/namespacegurls.html#a4015e8417bc5f4375da5524d7b67338c" title="Generates a submatrix from an input matrix.">subMatrixFromRows</a>(y.<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>(), n, t, va, nva, yva_tmp-&gt;<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>());
<a name="l00089"></a>00089         yva = yva_tmp;
<a name="l00090"></a>00090 
<a name="l00091"></a>00091 
<a name="l00092"></a>00092     <span class="comment">//    delete splitOpt;</span>
<a name="l00093"></a>00093         <span class="keyword">delete</span> [] trva;
<a name="l00094"></a>00094     }
<a name="l00095"></a>00095     <span class="keywordflow">else</span>
<a name="l00096"></a>00096     {
<a name="l00097"></a>00097         Xtr = &amp;X;
<a name="l00098"></a>00098         ytr = &amp;y;
<a name="l00099"></a>00099 
<a name="l00100"></a>00100         ntr = n;
<a name="l00101"></a>00101         nva = 0;
<a name="l00102"></a>00102     }
<a name="l00103"></a>00103 
<a name="l00104"></a>00104 
<a name="l00105"></a>00105 
<a name="l00106"></a>00106     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> guesses_end = <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">long</span><span class="keyword">&gt;</span>(n_nystrom);
<a name="l00107"></a>00107 
<a name="l00108"></a>00108     std::vector&lt;unsigned long&gt; guesses;
<a name="l00109"></a>00109     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> step = <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">long</span><span class="keyword">&gt;</span>(floor(n_nystrom/nparams));
<a name="l00110"></a>00110     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> i = guesses_end-1, count = 0; count &lt; nparams; i-=step, ++count)
<a name="l00111"></a>00111         guesses.push_back(i);
<a name="l00112"></a>00112 
<a name="l00113"></a>00113 
<a name="l00114"></a>00114 <span class="comment">//    indices = randperm(ntr);</span>
<a name="l00115"></a>00115     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> indices_length = 0;
<a name="l00116"></a>00116     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *indices = getIndices(y, ntr, t, guesses_end, indices_length);
<a name="l00117"></a>00117 
<a name="l00118"></a>00118 
<a name="l00119"></a>00119 
<a name="l00120"></a>00120     <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;unsigned long&gt;</a> *indices_mat = <span class="keyword">new</span> <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;unsigned long&gt;</a>(indices_length, 1);
<a name="l00121"></a>00121     <a class="code" href="../../db/d4e/namespacegurls.html#acf8c56c7e1dddb56e5b6b65fcb817ded" title="Copies element form one vector to another one.">copy</a>(indices_mat-&gt;<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>(), indices, indices_length);
<a name="l00122"></a>00122     paramsel-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a93430579dc5f429ccc16106a7e643b69" title="Adds a generic option to the list indexed with a specified key.">addOpt</a>(<span class="stringliteral">&quot;indices&quot;</span>, <span class="keyword">new</span> <a class="code" href="../../de/d63/classgurls_1_1_opt_matrix.html" title="OptMatrix is an option containing a matrix.">OptMatrix</a>&lt;<a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;unsigned long&gt;</a> &gt;(*indices_mat));
<a name="l00123"></a>00123 
<a name="l00124"></a>00124 
<a name="l00125"></a>00125 <span class="comment">//    vout.perf = zeros(length(guesses),1);</span>
<a name="l00126"></a>00126     <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> *perf_mat = <span class="keyword">new</span> <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a>(guesses.size(), 1);
<a name="l00127"></a>00127     paramsel-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a93430579dc5f429ccc16106a7e643b69" title="Adds a generic option to the list indexed with a specified key.">addOpt</a>(<span class="stringliteral">&quot;acc&quot;</span>, <span class="keyword">new</span> <a class="code" href="../../de/d63/classgurls_1_1_opt_matrix.html" title="OptMatrix is an option containing a matrix.">OptMatrix</a>&lt;<a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> &gt;(*perf_mat));
<a name="l00128"></a>00128     T* perf_it = perf_mat-&gt;<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>();
<a name="l00129"></a>00129     <span class="keyword">set</span>(perf_it, (T)-1, guesses.size());
<a name="l00130"></a>00130 
<a name="l00131"></a>00131     <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;unsigned long&gt;</a> *times_mat = <span class="keyword">new</span> <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;unsigned long&gt;</a>(guesses.size(), 1);
<a name="l00132"></a>00132     paramsel-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a93430579dc5f429ccc16106a7e643b69" title="Adds a generic option to the list indexed with a specified key.">addOpt</a>(<span class="stringliteral">&quot;times&quot;</span>, <span class="keyword">new</span> <a class="code" href="../../de/d63/classgurls_1_1_opt_matrix.html" title="OptMatrix is an option containing a matrix.">OptMatrix</a>&lt;<a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;unsigned long&gt;</a> &gt;(*times_mat));
<a name="l00133"></a>00133     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *times_it = times_mat-&gt;<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>();
<a name="l00134"></a>00134     <span class="keyword">set</span>(times_it, 0ul, guesses.size());
<a name="l00135"></a>00135 
<a name="l00136"></a>00136 
<a name="l00137"></a>00137 
<a name="l00138"></a>00138 <span class="comment">//    Xsub = zeros(guesses(end),d);</span>
<a name="l00139"></a>00139     <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> *Xsub_mat = <span class="keyword">new</span> <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a>(guesses_end, d);
<a name="l00140"></a>00140     T *Xsub = Xsub_mat-&gt;<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>();
<a name="l00141"></a>00141     <span class="keyword">set</span>(Xsub, (T)0.0, guesses_end*d);
<a name="l00142"></a>00142 
<a name="l00143"></a>00143 <span class="comment">//    K = zeros(ntr,guesses(end));</span>
<a name="l00144"></a>00144 <span class="comment">//    Ktrva = zeros(nva,guesses(end));</span>
<a name="l00145"></a>00145     <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a>* K_mat = NULL;
<a name="l00146"></a>00146     T *K = NULL;
<a name="l00147"></a>00147     T* Ktrva = NULL;
<a name="l00148"></a>00148 
<a name="l00149"></a>00149     <span class="keywordflow">if</span>(split)
<a name="l00150"></a>00150     {
<a name="l00151"></a>00151         K_mat = <span class="keyword">new</span> <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a>(ntr, guesses_end);
<a name="l00152"></a>00152         K = K_mat-&gt;<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>();
<a name="l00153"></a>00153         <span class="keyword">set</span>(K, (T)0.0, ntr*guesses_end);
<a name="l00154"></a>00154 
<a name="l00155"></a>00155         Ktrva = <span class="keyword">new</span> T[nva*guesses_end];
<a name="l00156"></a>00156         <span class="keyword">set</span>(Ktrva, (T)0.0, nva*guesses_end);
<a name="l00157"></a>00157     }
<a name="l00158"></a>00158 
<a name="l00159"></a>00159 <span class="comment">//    KtK = zeros(guesses(end),guesses(end));</span>
<a name="l00160"></a>00160     T* KtK = <span class="keyword">new</span> T[guesses_end*guesses_end];
<a name="l00161"></a>00161     <span class="keyword">set</span>(KtK, (T)0.0, guesses_end*guesses_end);
<a name="l00162"></a>00162 
<a name="l00163"></a>00163 <span class="comment">//    i_init = 1;</span>
<a name="l00164"></a>00164     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> i_init = 0;
<a name="l00165"></a>00165 
<a name="l00166"></a>00166 
<a name="l00167"></a>00167 <span class="comment">//    opt_tmp.paramsel.sigma = opt.paramsel.sigma;</span>
<a name="l00168"></a>00168     <a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html" title="GurlsOptionsList is an option containing a list of options mapped by name.">GurlsOptionsList</a>* opt_tmp = <span class="keyword">new</span> <a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html" title="GurlsOptionsList is an option containing a list of options mapped by name.">GurlsOptionsList</a>(<span class="stringliteral">&quot;tmp&quot;</span>);
<a name="l00169"></a>00169     <a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html" title="GurlsOptionsList is an option containing a list of options mapped by name.">GurlsOptionsList</a>* tmp_kernel = <span class="keyword">new</span> <a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html" title="GurlsOptionsList is an option containing a list of options mapped by name.">GurlsOptionsList</a>(<span class="stringliteral">&quot;kernel&quot;</span>);
<a name="l00170"></a>00170     <a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html" title="GurlsOptionsList is an option containing a list of options mapped by name.">GurlsOptionsList</a>* tmp_paramsel = <span class="keyword">new</span> <a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html" title="GurlsOptionsList is an option containing a list of options mapped by name.">GurlsOptionsList</a>(<span class="stringliteral">&quot;paramsel&quot;</span>);
<a name="l00171"></a>00171     <a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html" title="GurlsOptionsList is an option containing a list of options mapped by name.">GurlsOptionsList</a>* tmp_optimizer = <span class="keyword">new</span> <a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html" title="GurlsOptionsList is an option containing a list of options mapped by name.">GurlsOptionsList</a>(<span class="stringliteral">&quot;optimizer&quot;</span>);
<a name="l00172"></a>00172 
<a name="l00173"></a>00173     opt_tmp-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a93430579dc5f429ccc16106a7e643b69" title="Adds a generic option to the list indexed with a specified key.">addOpt</a>(<span class="stringliteral">&quot;kernel&quot;</span>, tmp_kernel);
<a name="l00174"></a>00174     opt_tmp-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a93430579dc5f429ccc16106a7e643b69" title="Adds a generic option to the list indexed with a specified key.">addOpt</a>(<span class="stringliteral">&quot;paramsel&quot;</span>, tmp_paramsel);
<a name="l00175"></a>00175     opt_tmp-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a93430579dc5f429ccc16106a7e643b69" title="Adds a generic option to the list indexed with a specified key.">addOpt</a>(<span class="stringliteral">&quot;optimizer&quot;</span>, tmp_optimizer);
<a name="l00176"></a>00176 
<a name="l00177"></a>00177     tmp_kernel-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a93430579dc5f429ccc16106a7e643b69" title="Adds a generic option to the list indexed with a specified key.">addOpt</a>(<span class="stringliteral">&quot;type&quot;</span>, opt-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#ad0d2298f85d7e89e810f5234b6e85abb" title="Returns a string option mapped with a key.">getOptAsString</a>(<span class="stringliteral">&quot;kernel.type&quot;</span>));
<a name="l00178"></a>00178     tmp_paramsel-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a93430579dc5f429ccc16106a7e643b69" title="Adds a generic option to the list indexed with a specified key.">addOpt</a>(<span class="stringliteral">&quot;sigma&quot;</span>, <span class="keyword">new</span> <a class="code" href="../../d9/d58/classgurls_1_1_opt_number.html" title="OptNumber is an option containing a double precision floating point number.">OptNumber</a>(sigma));
<a name="l00179"></a>00179 
<a name="l00180"></a>00180 
<a name="l00181"></a>00181     <a class="code" href="../../d3/dd7/classgurls_1_1_pred_kernel_train_test.html" title="PredKernelTrainTest is the sub-class of PredKernel that computes the kernel matrix between training a...">PredKernelTrainTest&lt;T&gt;</a> predKernelTask;
<a name="l00182"></a>00182 
<a name="l00183"></a>00183     <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> *alpha_mat = <span class="keyword">new</span> <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a>(guesses_end, t);
<a name="l00184"></a>00184     T *<span class="keyword">const</span> alpha = alpha_mat-&gt;<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>();
<a name="l00185"></a>00185 
<a name="l00186"></a>00186     <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;unsigned long&gt;</a> *guesses_mat = <span class="keyword">new</span> <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;unsigned long&gt;</a>(guesses.size(), 1);
<a name="l00187"></a>00187     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *guesses_mat_it = guesses_mat-&gt;<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>();
<a name="l00188"></a>00188     <span class="keyword">set</span>(guesses_mat_it, 0ul, guesses.size());
<a name="l00189"></a>00189 
<a name="l00190"></a>00190     boost::posix_time::ptime begin, end;
<a name="l00191"></a>00191     boost::posix_time::time_duration diff;
<a name="l00192"></a>00192 
<a name="l00193"></a>00193     T prevPerf = (regression)? -std::numeric_limits&lt;T&gt;::max(): 0;
<a name="l00194"></a>00194 
<a name="l00195"></a>00195     begin = boost::posix_time::microsec_clock::local_time();
<a name="l00196"></a>00196     <span class="keywordflow">for</span>(std::vector&lt;unsigned long&gt;::iterator it = guesses.begin(); it != guesses.end(); ++it)
<a name="l00197"></a>00197     {
<a name="l00198"></a>00198         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> i = *it;
<a name="l00199"></a>00199 
<a name="l00200"></a>00200         *guesses_mat_it = i+1;
<a name="l00201"></a>00201 
<a name="l00202"></a>00202 <span class="comment">//        Xnew = Xtr(indices(i_init:i_end),:);</span>
<a name="l00203"></a>00203         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> nindices = i - i_init + 1;
<a name="l00204"></a>00204         <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> *Xnew = <span class="keyword">new</span> <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a>(nindices,d);
<a name="l00205"></a>00205         <a class="code" href="../../db/d4e/namespacegurls.html#a4015e8417bc5f4375da5524d7b67338c" title="Generates a submatrix from an input matrix.">subMatrixFromRows</a>(Xtr-&gt;<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>(), ntr, d, indices+i_init, nindices, Xnew-&gt;<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>());
<a name="l00206"></a>00206 
<a name="l00207"></a>00207 <span class="comment">//        opt_tmp.rls.X = Xnew;</span>
<a name="l00208"></a>00208         tmp_optimizer-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a93430579dc5f429ccc16106a7e643b69" title="Adds a generic option to the list indexed with a specified key.">addOpt</a>(<span class="stringliteral">&quot;X&quot;</span>, <span class="keyword">new</span> <a class="code" href="../../de/d63/classgurls_1_1_opt_matrix.html" title="OptMatrix is an option containing a matrix.">OptMatrix</a>&lt;<a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> &gt;(*Xnew, <span class="keyword">false</span>));
<a name="l00209"></a>00209 
<a name="l00210"></a>00210 <span class="comment">//        kernel = predkernel_traintest(Xtr,[],opt_tmp);</span>
<a name="l00211"></a>00211         <a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html" title="GurlsOptionsList is an option containing a list of options mapped by name.">GurlsOptionsList</a> *kernel = predKernelTask.<a class="code" href="../../d3/dd7/classgurls_1_1_pred_kernel_train_test.html#ad9ea7a49b769e20aada15fb1d7a4f0e4" title="Computes the kernel matrix between the training set and the test set X, in order to predict the label...">execute</a>(*Xtr, empty, *opt_tmp);
<a name="l00212"></a>00212 
<a name="l00213"></a>00213         <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> &amp;predkernel_K = kernel-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a11e973e29694f9090d3d213e2bfa0632" title="Returns a reference to the value contained into an option mapped with a key.">getOptValue</a>&lt;<a class="code" href="../../de/d63/classgurls_1_1_opt_matrix.html" title="OptMatrix is an option containing a matrix.">OptMatrix&lt;gMat2D&lt;T&gt;</a> &gt; &gt;(<span class="stringliteral">&quot;K&quot;</span>);
<a name="l00214"></a>00214 
<a name="l00215"></a>00215         <span class="keywordflow">if</span>(split)
<a name="l00216"></a>00216         {
<a name="l00217"></a>00217 <span class="comment">//            K(:,i_init:i_end) = kernel.K;</span>
<a name="l00218"></a>00218             <a class="code" href="../../db/d4e/namespacegurls.html#acf8c56c7e1dddb56e5b6b65fcb817ded" title="Copies element form one vector to another one.">copy</a>(K+(ntr*i_init), predkernel_K.<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>(), predkernel_K.<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a341174355a586bde91f682ff0574a071" title="Returns vector length.">getSize</a>());
<a name="l00219"></a>00219         }
<a name="l00220"></a>00220         <span class="keywordflow">else</span>
<a name="l00221"></a>00221         {
<a name="l00222"></a>00222             <a class="code" href="../../de/d63/classgurls_1_1_opt_matrix.html" title="OptMatrix is an option containing a matrix.">OptMatrix&lt;gMat2D&lt;T&gt;</a> &gt; * kk = kernel-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a1e3d2445536a446436eef89aef68a321" title="Returns a pointer to a T option mapped with a key.">getOptAs</a>&lt;<a class="code" href="../../de/d63/classgurls_1_1_opt_matrix.html" title="OptMatrix is an option containing a matrix.">OptMatrix&lt;gMat2D&lt;T&gt;</a> &gt; &gt;(<span class="stringliteral">&quot;K&quot;</span>);
<a name="l00223"></a>00223             kk-&gt;<a class="code" href="../../de/d63/classgurls_1_1_opt_matrix.html#acfd739dd3ea40687f5114e2aa06d4eb2" title="Remove ownership for matrix pointer.">detachValue</a>();
<a name="l00224"></a>00224 
<a name="l00225"></a>00225             <span class="keywordflow">if</span>(K_mat != NULL)
<a name="l00226"></a>00226                 <span class="keyword">delete</span> K_mat;
<a name="l00227"></a>00227 
<a name="l00228"></a>00228             K_mat = &amp;predkernel_K;
<a name="l00229"></a>00229             K = K_mat-&gt;<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>();
<a name="l00230"></a>00230         }
<a name="l00231"></a>00231 
<a name="l00232"></a>00232 
<a name="l00233"></a>00233 <span class="comment">//        KtK(i_init:i_end,i_init:i_end) = kernel.K&#39;*kernel.K;</span>
<a name="l00234"></a>00234         T* KtK_sub = <span class="keyword">new</span> T[nindices*nindices];
<a name="l00235"></a>00235 
<a name="l00236"></a>00236         <a class="code" href="../../db/d4e/namespacegurls.html#afaec98de689dfb205e909e39158b4bf3" title="Implements the standard GEMM routine from Level3 BLAS General Matrix-Matrix multiplication of two sin...">dot</a>(predkernel_K.<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>(), predkernel_K.<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>(), KtK_sub, ntr, nindices, ntr, nindices, nindices, nindices, CblasTrans, CblasNoTrans, CblasColMajor);
<a name="l00237"></a>00237         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> i=0; i&lt; nindices; ++i)
<a name="l00238"></a>00238             <a class="code" href="../../db/d4e/namespacegurls.html#acf8c56c7e1dddb56e5b6b65fcb817ded" title="Copies element form one vector to another one.">copy</a>(KtK+i_init+((i_init+i)*guesses_end), KtK_sub+(i*nindices), nindices);
<a name="l00239"></a>00239 
<a name="l00240"></a>00240         <span class="keyword">delete</span>[] KtK_sub;
<a name="l00241"></a>00241 
<a name="l00242"></a>00242 
<a name="l00243"></a>00243 <span class="comment">//        if guesses_c&gt;1</span>
<a name="l00244"></a>00244         <span class="keywordflow">if</span>(it != guesses.begin())
<a name="l00245"></a>00245         {
<a name="l00246"></a>00246 <span class="comment">//            KtKcol = K(:,1:(i_init-1))&#39;*kernel.K;</span>
<a name="l00247"></a>00247             T *KtKcol = <span class="keyword">new</span> T[i_init*nindices];
<a name="l00248"></a>00248             <a class="code" href="../../db/d4e/namespacegurls.html#afaec98de689dfb205e909e39158b4bf3" title="Implements the standard GEMM routine from Level3 BLAS General Matrix-Matrix multiplication of two sin...">dot</a>(K, predkernel_K.<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>(), KtKcol, ntr, i_init, ntr, nindices, i_init, nindices, CblasTrans, CblasNoTrans, CblasColMajor);
<a name="l00249"></a>00249 
<a name="l00250"></a>00250 <span class="comment">//            KtK(1:(i_init-1),i_init:i_end) = KtKcol;</span>
<a name="l00251"></a>00251 <span class="comment">//            KtK(i_init:i_end,1:(i_init-1)) = KtKcol&#39;;</span>
<a name="l00252"></a>00252             <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> j=0; j&lt;nindices; ++j)
<a name="l00253"></a>00253             {
<a name="l00254"></a>00254                 <a class="code" href="../../db/d4e/namespacegurls.html#acf8c56c7e1dddb56e5b6b65fcb817ded" title="Copies element form one vector to another one.">copy</a>(KtK+(guesses_end*(i_init+j)), KtKcol+(i_init*j), i_init);
<a name="l00255"></a>00255                 <a class="code" href="../../db/d4e/namespacegurls.html#acf8c56c7e1dddb56e5b6b65fcb817ded" title="Copies element form one vector to another one.">copy</a>(KtK+i_init+j, KtKcol+(i_init*j), i_init, guesses_end, 1);
<a name="l00256"></a>00256             }
<a name="l00257"></a>00257 
<a name="l00258"></a>00258             <span class="keyword">delete</span> [] KtKcol;
<a name="l00259"></a>00259         }
<a name="l00260"></a>00260 
<a name="l00261"></a>00261         <span class="keyword">delete</span> kernel;
<a name="l00262"></a>00262 
<a name="l00263"></a>00263 <span class="comment">//        alpha = pinv(KtK(1:i_end,1:i_end))*(K(:,1:i_end)&#39;*ytr);</span>
<a name="l00264"></a>00264 
<a name="l00265"></a>00265         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> ii = i+1;
<a name="l00266"></a>00266 
<a name="l00267"></a>00267 
<a name="l00268"></a>00268         KtK_sub = <span class="keyword">new</span> T[ ii*ii];
<a name="l00269"></a>00269         <span class="keywordflow">for</span>(T *K_it = KtK, *Ks_it = KtK_sub, *<span class="keyword">const</span> K_end = K_it+(guesses_end*ii); K_it != K_end; K_it+=guesses_end, Ks_it+=ii)
<a name="l00270"></a>00270             <a class="code" href="../../db/d4e/namespacegurls.html#acf8c56c7e1dddb56e5b6b65fcb817ded" title="Copies element form one vector to another one.">copy</a>(Ks_it, K_it, ii);
<a name="l00271"></a>00271 
<a name="l00272"></a>00272         <span class="keywordtype">int</span> r, c;
<a name="l00273"></a>00273         T *pinv_K = <a class="code" href="../../db/d4e/namespacegurls.html#a753b9fab2b7733245db71f4d59bcfc9b" title="Computes the pseudo-inverse of a non square matrix A.">pinv</a>(KtK_sub, ii, ii, r, c);
<a name="l00274"></a>00274         <span class="keyword">delete</span> [] KtK_sub;
<a name="l00275"></a>00275 
<a name="l00276"></a>00276         T *Kty = <span class="keyword">new</span> T[ii*t];
<a name="l00277"></a>00277         <a class="code" href="../../db/d4e/namespacegurls.html#afaec98de689dfb205e909e39158b4bf3" title="Implements the standard GEMM routine from Level3 BLAS General Matrix-Matrix multiplication of two sin...">dot</a>(K, ytr-&gt;<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>(), Kty, ntr, ii, ntr, t, ii, t, CblasTrans, CblasNoTrans, CblasColMajor);
<a name="l00278"></a>00278 
<a name="l00279"></a>00279 
<a name="l00280"></a>00280         <a class="code" href="../../db/d4e/namespacegurls.html#afaec98de689dfb205e909e39158b4bf3" title="Implements the standard GEMM routine from Level3 BLAS General Matrix-Matrix multiplication of two sin...">dot</a>(pinv_K, Kty, alpha, ii, ii, ii, t, ii, t, CblasNoTrans, CblasNoTrans, CblasColMajor);
<a name="l00281"></a>00281 
<a name="l00282"></a>00282         <span class="keyword">delete</span> [] Kty;
<a name="l00283"></a>00283         <span class="keyword">delete</span> [] pinv_K;
<a name="l00284"></a>00284 
<a name="l00285"></a>00285 
<a name="l00286"></a>00286         <span class="keywordflow">if</span>(split)
<a name="l00287"></a>00287         {
<a name="l00288"></a>00288     <span class="comment">//        validation error</span>
<a name="l00289"></a>00289     <span class="comment">//        kernel = predkernel_traintest(Xva,[],opt_tmp);</span>
<a name="l00290"></a>00290             kernel = predKernelTask.<a class="code" href="../../d3/dd7/classgurls_1_1_pred_kernel_train_test.html#ad9ea7a49b769e20aada15fb1d7a4f0e4" title="Computes the kernel matrix between the training set and the test set X, in order to predict the label...">execute</a>(*Xva, empty, *opt_tmp);
<a name="l00291"></a>00291 
<a name="l00292"></a>00292     <span class="comment">//        Ktrva(:,i_init:i_end) = kernel.K;</span>
<a name="l00293"></a>00293             <span class="keyword">const</span> <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> &amp;predkernel_Kva = kernel-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a11e973e29694f9090d3d213e2bfa0632" title="Returns a reference to the value contained into an option mapped with a key.">getOptValue</a>&lt;<a class="code" href="../../de/d63/classgurls_1_1_opt_matrix.html" title="OptMatrix is an option containing a matrix.">OptMatrix&lt;gMat2D&lt;T&gt;</a> &gt; &gt;(<span class="stringliteral">&quot;K&quot;</span>);
<a name="l00294"></a>00294             <a class="code" href="../../db/d4e/namespacegurls.html#acf8c56c7e1dddb56e5b6b65fcb817ded" title="Copies element form one vector to another one.">copy</a>(Ktrva+(nva*i_init), predkernel_Kva.<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>(), predkernel_Kva.<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a341174355a586bde91f682ff0574a071" title="Returns vector length.">getSize</a>());
<a name="l00295"></a>00295             <span class="keyword">delete</span> kernel;
<a name="l00296"></a>00296 
<a name="l00297"></a>00297 
<a name="l00298"></a>00298     <span class="comment">//        opt.pred = Ktrva(:,1:i_end)*alpha;</span>
<a name="l00299"></a>00299             <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a>* pred = <span class="keyword">new</span> <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a>(nva ,t);
<a name="l00300"></a>00300             <a class="code" href="../../db/d4e/namespacegurls.html#afaec98de689dfb205e909e39158b4bf3" title="Implements the standard GEMM routine from Level3 BLAS General Matrix-Matrix multiplication of two sin...">dot</a>(Ktrva, alpha, pred-&gt;<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>(), nva, ii, ii, t, nva, t, CblasNoTrans, CblasNoTrans, CblasColMajor);
<a name="l00301"></a>00301             opt-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a93430579dc5f429ccc16106a7e643b69" title="Adds a generic option to the list indexed with a specified key.">addOpt</a>(<span class="stringliteral">&quot;pred&quot;</span>, <span class="keyword">new</span> <a class="code" href="../../de/d63/classgurls_1_1_opt_matrix.html" title="OptMatrix is an option containing a matrix.">OptMatrix</a>&lt;<a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> &gt;(*pred));
<a name="l00302"></a>00302 
<a name="l00303"></a>00303     <span class="comment">//        perf = opt.hoperf([],yva,opt);</span>
<a name="l00304"></a>00304             <a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html" title="GurlsOptionsList is an option containing a list of options mapped by name.">GurlsOptionsList</a> *perf = perfTask-&gt;<a class="code" href="../../d5/dac/classgurls_1_1_performance.html#aced03c5a143ea22d0e7260737376eb82" title="Evaluates prediction performance.">execute</a>(empty, *yva, *opt);
<a name="l00305"></a>00305             opt-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a7197b056bb30449f518a43cb564ec011" title="Removes the option mapped with a specified key.">removeOpt</a>(<span class="stringliteral">&quot;pred&quot;</span>);
<a name="l00306"></a>00306 
<a name="l00307"></a>00307             <span class="keywordflow">if</span>(regression)
<a name="l00308"></a>00308                 *perf_it =  <span class="keyword">static_cast&lt;</span>T<span class="keyword">&gt;</span>(perf-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a11e973e29694f9090d3d213e2bfa0632" title="Returns a reference to the value contained into an option mapped with a key.">getOptValue</a>&lt;<a class="code" href="../../d9/d58/classgurls_1_1_opt_number.html" title="OptNumber is an option containing a double precision floating point number.">OptNumber</a>&gt;(<span class="stringliteral">&quot;forho&quot;</span>));
<a name="l00309"></a>00309             <span class="keywordflow">else</span>
<a name="l00310"></a>00310             {
<a name="l00311"></a>00311         <span class="comment">//        vout.perf(guesses_c) = mean(perf.forho);</span>
<a name="l00312"></a>00312                 <span class="keyword">const</span> <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> &amp;acc = perf-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a11e973e29694f9090d3d213e2bfa0632" title="Returns a reference to the value contained into an option mapped with a key.">getOptValue</a>&lt;<a class="code" href="../../de/d63/classgurls_1_1_opt_matrix.html" title="OptMatrix is an option containing a matrix.">OptMatrix&lt;gMat2D&lt;T&gt;</a> &gt; &gt;(<span class="stringliteral">&quot;acc&quot;</span>);
<a name="l00313"></a>00313 
<a name="l00314"></a>00314                 *perf_it = <a class="code" href="../../db/d4e/namespacegurls.html#a2f1802e90fc6d89dcc35bfef3c369250" title="Computes the sum of all elements of a vector.">sumv</a>(acc.<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>(), acc.<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a341174355a586bde91f682ff0574a071" title="Returns vector length.">getSize</a>())/acc.<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a341174355a586bde91f682ff0574a071" title="Returns vector length.">getSize</a>();
<a name="l00315"></a>00315             }
<a name="l00316"></a>00316 
<a name="l00317"></a>00317 
<a name="l00318"></a>00318             <span class="keyword">delete</span> perf;
<a name="l00319"></a>00319         }
<a name="l00320"></a>00320 
<a name="l00321"></a>00321         tmp_optimizer-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a7197b056bb30449f518a43cb564ec011" title="Removes the option mapped with a specified key.">removeOpt</a>(<span class="stringliteral">&quot;X&quot;</span>);
<a name="l00322"></a>00322 
<a name="l00323"></a>00323 <span class="comment">//        Xsub(i_init:i_end,:) = Xnew;</span>
<a name="l00324"></a>00324         <span class="keywordflow">for</span>(T* Xsub_it = Xsub+i_init, *Xsub_end = Xsub_it+(guesses_end*d), *Xnew_it = Xnew-&gt;<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>(); Xsub_it != Xsub_end; Xsub_it+=guesses_end, Xnew_it+=nindices)
<a name="l00325"></a>00325             <a class="code" href="../../db/d4e/namespacegurls.html#acf8c56c7e1dddb56e5b6b65fcb817ded" title="Copies element form one vector to another one.">copy</a>(Xsub_it, Xnew_it, nindices);
<a name="l00326"></a>00326 
<a name="l00327"></a>00327 
<a name="l00328"></a>00328         <span class="keyword">delete</span> Xnew;
<a name="l00329"></a>00329 
<a name="l00330"></a>00330 <span class="comment">//        i_init = i_end+1;</span>
<a name="l00331"></a>00331         i_init = i+1;
<a name="l00332"></a>00332 
<a name="l00333"></a>00333         end = boost::posix_time::microsec_clock::local_time();
<a name="l00334"></a>00334         diff = end-begin;
<a name="l00335"></a>00335 
<a name="l00336"></a>00336         *times_it = <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">long</span><span class="keyword">&gt;</span>(diff.total_milliseconds());
<a name="l00337"></a>00337         ++times_it;
<a name="l00338"></a>00338 
<a name="l00339"></a>00339         <span class="keywordflow">if</span>(<a class="code" href="../../db/d4e/namespacegurls.html#a141eeb37a2b25f93bfcde3453641dc8c" title="&quot;Less or equal than&quot; operator between two scalars">le</a>(*perf_it, prevPerf) &amp;&amp; i &gt; 10)
<a name="l00340"></a>00340             <span class="keywordflow">break</span>;
<a name="l00341"></a>00341         <span class="keywordflow">else</span>
<a name="l00342"></a>00342         {
<a name="l00343"></a>00343             prevPerf = *perf_it;
<a name="l00344"></a>00344 
<a name="l00345"></a>00345             ++perf_it;
<a name="l00346"></a>00346             ++guesses_mat_it;
<a name="l00347"></a>00347         }
<a name="l00348"></a>00348     }
<a name="l00349"></a>00349 
<a name="l00350"></a>00350     <span class="keywordflow">if</span>(split)
<a name="l00351"></a>00351     {
<a name="l00352"></a>00352         <span class="keyword">delete</span> Xtr;
<a name="l00353"></a>00353         <span class="keyword">delete</span> ytr;
<a name="l00354"></a>00354         <span class="keyword">delete</span> Xva;
<a name="l00355"></a>00355         <span class="keyword">delete</span> yva;
<a name="l00356"></a>00356 
<a name="l00357"></a>00357         <span class="keyword">delete</span> [] Ktrva;
<a name="l00358"></a>00358     }
<a name="l00359"></a>00359 
<a name="l00360"></a>00360     <span class="keyword">delete</span> K_mat;
<a name="l00361"></a>00361 
<a name="l00362"></a>00362     <span class="keyword">delete</span> [] indices;
<a name="l00363"></a>00363     <span class="keyword">delete</span> [] KtK;
<a name="l00364"></a>00364 
<a name="l00365"></a>00365     <span class="keyword">delete</span> perfTask;
<a name="l00366"></a>00366     <span class="keyword">delete</span> opt_tmp;
<a name="l00367"></a>00367 
<a name="l00368"></a>00368 
<a name="l00369"></a>00369     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> nsub;
<a name="l00370"></a>00370 
<a name="l00371"></a>00371     <span class="keywordflow">if</span>(guesses_mat_it - guesses_mat-&gt;<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>() &lt; guesses_mat-&gt;<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a341174355a586bde91f682ff0574a071" title="Returns vector length.">getSize</a>()-1)
<a name="l00372"></a>00372     {
<a name="l00373"></a>00373         nsub = *guesses_mat_it;
<a name="l00374"></a>00374         <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> *Xsub_mat_sub = <span class="keyword">new</span> <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a>(nsub, d);
<a name="l00375"></a>00375 
<a name="l00376"></a>00376         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> size = nsub*d;
<a name="l00377"></a>00377 
<a name="l00378"></a>00378         <span class="keywordflow">for</span>(T* it = Xsub_mat_sub-&gt;<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>(), *end = it+(size), *X_it = Xsub_mat-&gt;<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>(); it != end; it+=nsub, X_it+=guesses_end)
<a name="l00379"></a>00379             <a class="code" href="../../db/d4e/namespacegurls.html#acf8c56c7e1dddb56e5b6b65fcb817ded" title="Copies element form one vector to another one.">copy</a>(it, X_it, nsub);
<a name="l00380"></a>00380 
<a name="l00381"></a>00381         <span class="keyword">delete</span> Xsub_mat;
<a name="l00382"></a>00382         Xsub_mat = Xsub_mat_sub;
<a name="l00383"></a>00383     }
<a name="l00384"></a>00384     <span class="keywordflow">else</span>
<a name="l00385"></a>00385         nsub = guesses_end;
<a name="l00386"></a>00386 
<a name="l00387"></a>00387 
<a name="l00388"></a>00388 <span class="comment">//    vout.X = Xsub(1:i_end,:);</span>
<a name="l00389"></a>00389     paramsel-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a93430579dc5f429ccc16106a7e643b69" title="Adds a generic option to the list indexed with a specified key.">addOpt</a>(<span class="stringliteral">&quot;X&quot;</span>, <span class="keyword">new</span> <a class="code" href="../../de/d63/classgurls_1_1_opt_matrix.html" title="OptMatrix is an option containing a matrix.">OptMatrix</a>&lt;<a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> &gt;(*Xsub_mat));
<a name="l00390"></a>00390 
<a name="l00391"></a>00391 <span class="comment">//    vout.C = alpha;</span>
<a name="l00392"></a>00392     paramsel-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a93430579dc5f429ccc16106a7e643b69" title="Adds a generic option to the list indexed with a specified key.">addOpt</a>(<span class="stringliteral">&quot;C&quot;</span>, <span class="keyword">new</span> <a class="code" href="../../de/d63/classgurls_1_1_opt_matrix.html" title="OptMatrix is an option containing a matrix.">OptMatrix</a>&lt;<a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> &gt;(*alpha_mat));
<a name="l00393"></a>00393 
<a name="l00394"></a>00394 <span class="comment">//    [dummy,vout.n_opt] = max(vout.perf);</span>
<a name="l00395"></a>00395     paramsel-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a93430579dc5f429ccc16106a7e643b69" title="Adds a generic option to the list indexed with a specified key.">addOpt</a>(<span class="stringliteral">&quot;n_opt&quot;</span>, <span class="keyword">new</span> <a class="code" href="../../d9/d58/classgurls_1_1_opt_number.html" title="OptNumber is an option containing a double precision floating point number.">OptNumber</a>(*std::max_element(perf_mat-&gt;<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>(), perf_mat-&gt;<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>()+perf_mat-&gt;<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a341174355a586bde91f682ff0574a071" title="Returns vector length.">getSize</a>())));
<a name="l00396"></a>00396 
<a name="l00397"></a>00397 <span class="comment">//    vout.guesses = guesses;</span>
<a name="l00398"></a>00398     paramsel-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a93430579dc5f429ccc16106a7e643b69" title="Adds a generic option to the list indexed with a specified key.">addOpt</a>(<span class="stringliteral">&quot;guesses&quot;</span>, <span class="keyword">new</span> <a class="code" href="../../de/d63/classgurls_1_1_opt_matrix.html" title="OptMatrix is an option containing a matrix.">OptMatrix</a>&lt;<a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;unsigned long&gt;</a> &gt;(*guesses_mat));
<a name="l00399"></a>00399 
<a name="l00400"></a>00400 }
<a name="l00401"></a>00401 
<a name="l00402"></a>00402 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;
<a name="l00403"></a><a class="code" href="../../d2/d25/classgurls_1_1_nystrom_wrapper.html#ab6b53ee3b53b5705060a960e5de35e49">00403</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/d25/classgurls_1_1_nystrom_wrapper.html#ab6b53ee3b53b5705060a960e5de35e49" title="Initial parameter selection and training, optimized for large_scale data.">NystromWrapper&lt;T&gt;::train_largescale</a>(<span class="keyword">const</span> <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> &amp;X, <span class="keyword">const</span> <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> &amp;y)
<a name="l00404"></a>00404 {
<a name="l00405"></a>00405     <a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html" title="GurlsOptionsList is an option containing a list of options mapped by name.">GurlsOptionsList</a> *opt = this-&gt;opt;
<a name="l00406"></a>00406 
<a name="l00407"></a>00407     <a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html" title="GurlsOptionsList is an option containing a list of options mapped by name.">GurlsOptionsList</a>* paramsel = opt-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a1e3d2445536a446436eef89aef68a321" title="Returns a pointer to a T option mapped with a key.">getOptAs</a>&lt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html" title="GurlsOptionsList is an option containing a list of options mapped by name.">GurlsOptionsList</a>&gt;(<span class="stringliteral">&quot;paramsel&quot;</span>);
<a name="l00408"></a>00408     paramsel-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a7197b056bb30449f518a43cb564ec011" title="Removes the option mapped with a specified key.">removeOpt</a>(<span class="stringliteral">&quot;X&quot;</span>);
<a name="l00409"></a>00409     paramsel-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a7197b056bb30449f518a43cb564ec011" title="Removes the option mapped with a specified key.">removeOpt</a>(<span class="stringliteral">&quot;C&quot;</span>);
<a name="l00410"></a>00410     paramsel-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a7197b056bb30449f518a43cb564ec011" title="Removes the option mapped with a specified key.">removeOpt</a>(<span class="stringliteral">&quot;n_opt&quot;</span>);
<a name="l00411"></a>00411     paramsel-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a7197b056bb30449f518a43cb564ec011" title="Removes the option mapped with a specified key.">removeOpt</a>(<span class="stringliteral">&quot;guesses&quot;</span>);
<a name="l00412"></a>00412     paramsel-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a7197b056bb30449f518a43cb564ec011" title="Removes the option mapped with a specified key.">removeOpt</a>(<span class="stringliteral">&quot;acc&quot;</span>);
<a name="l00413"></a>00413     paramsel-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a7197b056bb30449f518a43cb564ec011" title="Removes the option mapped with a specified key.">removeOpt</a>(<span class="stringliteral">&quot;times&quot;</span>);
<a name="l00414"></a>00414     paramsel-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a7197b056bb30449f518a43cb564ec011" title="Removes the option mapped with a specified key.">removeOpt</a>(<span class="stringliteral">&quot;indices&quot;</span>);
<a name="l00415"></a>00415 
<a name="l00416"></a>00416 
<a name="l00417"></a>00417     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> n = X.<a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html#a5ef176755f75f33e282fc1ac976958da" title="Returns the number of rows.">rows</a>();
<a name="l00418"></a>00418     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> d = X.<a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html#afa235cd07be1afe30497d55c90c42844" title="Returns the number of columns.">cols</a>();
<a name="l00419"></a>00419     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> t = y.<a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html#afa235cd07be1afe30497d55c90c42844" title="Returns the number of columns.">cols</a>();
<a name="l00420"></a>00420 
<a name="l00421"></a>00421     <span class="keyword">const</span> <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> empty;
<a name="l00422"></a>00422 
<a name="l00423"></a>00423     <span class="keyword">const</span> <span class="keywordtype">double</span> sigma = opt-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a45c4d02344b2c83c3641f4b41034e320" title="Returns a numeric option mapped with a key.">getOptAsNumber</a>(<span class="stringliteral">&quot;paramsel.sigma&quot;</span>);
<a name="l00424"></a>00424 
<a name="l00425"></a>00425     <span class="keyword">const</span> <span class="keywordtype">double</span> n_nystrom = opt-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a45c4d02344b2c83c3641f4b41034e320" title="Returns a numeric option mapped with a key.">getOptAsNumber</a>(<span class="stringliteral">&quot;n_nystrom&quot;</span>);
<a name="l00426"></a>00426 <span class="comment">//    B = opt.nystrom_blocksize;</span>
<a name="l00427"></a>00427     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> B = <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">long</span><span class="keyword">&gt;</span>(opt-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a45c4d02344b2c83c3641f4b41034e320" title="Returns a numeric option mapped with a key.">getOptAsNumber</a>(<span class="stringliteral">&quot;nlambda&quot;</span>));
<a name="l00428"></a>00428 
<a name="l00429"></a>00429     <span class="keyword">const</span> <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> *Xtr = &amp;X;
<a name="l00430"></a>00430     <span class="keyword">const</span> <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> *ytr = &amp;y;
<a name="l00431"></a>00431 
<a name="l00432"></a>00432     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> ntr = n;
<a name="l00433"></a>00433 
<a name="l00434"></a>00434 
<a name="l00435"></a>00435     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> guesses_end = <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">long</span><span class="keyword">&gt;</span>(n_nystrom);
<a name="l00436"></a>00436 
<a name="l00437"></a>00437 <span class="comment">//    guesses = B:B:opt.rank_max;</span>
<a name="l00438"></a>00438     std::vector&lt;unsigned long&gt; guesses;
<a name="l00439"></a>00439     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> i = B-1; i &lt; guesses_end; i+=B)
<a name="l00440"></a>00440         guesses.push_back(i);
<a name="l00441"></a>00441 
<a name="l00442"></a>00442     guesses_end = *(guesses.rbegin())+1;
<a name="l00443"></a>00443 
<a name="l00444"></a>00444 <span class="comment">//    indices = randperm(ntr);</span>
<a name="l00445"></a>00445     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> indices_length = 0;
<a name="l00446"></a>00446     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *indices = getIndices(y, ntr, t, guesses_end, indices_length);
<a name="l00447"></a>00447 
<a name="l00448"></a>00448 
<a name="l00449"></a>00449 
<a name="l00450"></a>00450     <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;unsigned long&gt;</a> *indices_mat = <span class="keyword">new</span> <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;unsigned long&gt;</a>(indices_length, 1);
<a name="l00451"></a>00451     <a class="code" href="../../db/d4e/namespacegurls.html#acf8c56c7e1dddb56e5b6b65fcb817ded" title="Copies element form one vector to another one.">copy</a>(indices_mat-&gt;<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>(), indices, indices_length);
<a name="l00452"></a>00452     paramsel-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a93430579dc5f429ccc16106a7e643b69" title="Adds a generic option to the list indexed with a specified key.">addOpt</a>(<span class="stringliteral">&quot;indices&quot;</span>, <span class="keyword">new</span> <a class="code" href="../../de/d63/classgurls_1_1_opt_matrix.html" title="OptMatrix is an option containing a matrix.">OptMatrix</a>&lt;<a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;unsigned long&gt;</a> &gt;(*indices_mat));
<a name="l00453"></a>00453 
<a name="l00454"></a>00454 
<a name="l00455"></a>00455     <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;unsigned long&gt;</a> *times_mat = <span class="keyword">new</span> <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;unsigned long&gt;</a>(guesses.size(), 1);
<a name="l00456"></a>00456     paramsel-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a93430579dc5f429ccc16106a7e643b69" title="Adds a generic option to the list indexed with a specified key.">addOpt</a>(<span class="stringliteral">&quot;times&quot;</span>, <span class="keyword">new</span> <a class="code" href="../../de/d63/classgurls_1_1_opt_matrix.html" title="OptMatrix is an option containing a matrix.">OptMatrix</a>&lt;<a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;unsigned long&gt;</a> &gt;(*times_mat));
<a name="l00457"></a>00457     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *times_it = times_mat-&gt;<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>();
<a name="l00458"></a>00458     <span class="keyword">set</span>(times_it, 0ul, guesses.size());
<a name="l00459"></a>00459 
<a name="l00460"></a>00460 
<a name="l00461"></a>00461 
<a name="l00462"></a>00462 <span class="comment">//    Xsub = zeros(guesses(end),d);</span>
<a name="l00463"></a>00463     <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> *Xsub_mat = <span class="keyword">new</span> <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a>(guesses_end, d);
<a name="l00464"></a>00464     T *Xsub = Xsub_mat-&gt;<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>();
<a name="l00465"></a>00465     <span class="keyword">set</span>(Xsub, (T)0.0, guesses_end*d);
<a name="l00466"></a>00466 
<a name="l00467"></a>00467 <span class="comment">//    KtK = zeros(guesses(end),guesses(end));</span>
<a name="l00468"></a>00468     T *KtK = <span class="keyword">new</span> T[guesses_end*guesses_end];
<a name="l00469"></a>00469     <span class="keyword">set</span>(KtK, (T)0.0, guesses_end*guesses_end);
<a name="l00470"></a>00470 
<a name="l00471"></a>00471     <span class="comment">//    Kty = zeros(guesses(end),T);</span>
<a name="l00472"></a>00472     T *Kty = <span class="keyword">new</span> T[guesses_end*t];
<a name="l00473"></a>00473     <span class="keyword">set</span>(Kty, (T)0.0, guesses_end*t);
<a name="l00474"></a>00474 
<a name="l00475"></a>00475 <span class="comment">//    i_init = 1;</span>
<a name="l00476"></a>00476     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> i_init = 0;
<a name="l00477"></a>00477 
<a name="l00478"></a>00478 
<a name="l00479"></a>00479 <span class="comment">//    opt_tmp.paramsel.sigma = opt.paramsel.sigma;</span>
<a name="l00480"></a>00480 <span class="comment">//    opt_tmp.kernel.type = opt.kernel.type;</span>
<a name="l00481"></a>00481 
<a name="l00482"></a>00482     <a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html" title="GurlsOptionsList is an option containing a list of options mapped by name.">GurlsOptionsList</a>* opt_tmp = <span class="keyword">new</span> <a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html" title="GurlsOptionsList is an option containing a list of options mapped by name.">GurlsOptionsList</a>(<span class="stringliteral">&quot;tmp&quot;</span>);
<a name="l00483"></a>00483     <a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html" title="GurlsOptionsList is an option containing a list of options mapped by name.">GurlsOptionsList</a>* tmp_kernel = <span class="keyword">new</span> <a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html" title="GurlsOptionsList is an option containing a list of options mapped by name.">GurlsOptionsList</a>(<span class="stringliteral">&quot;kernel&quot;</span>);
<a name="l00484"></a>00484     <a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html" title="GurlsOptionsList is an option containing a list of options mapped by name.">GurlsOptionsList</a>* tmp_paramsel = <span class="keyword">new</span> <a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html" title="GurlsOptionsList is an option containing a list of options mapped by name.">GurlsOptionsList</a>(<span class="stringliteral">&quot;paramsel&quot;</span>);
<a name="l00485"></a>00485     <a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html" title="GurlsOptionsList is an option containing a list of options mapped by name.">GurlsOptionsList</a>* tmp_optimizer = <span class="keyword">new</span> <a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html" title="GurlsOptionsList is an option containing a list of options mapped by name.">GurlsOptionsList</a>(<span class="stringliteral">&quot;optimizer&quot;</span>);
<a name="l00486"></a>00486 
<a name="l00487"></a>00487     opt_tmp-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a93430579dc5f429ccc16106a7e643b69" title="Adds a generic option to the list indexed with a specified key.">addOpt</a>(<span class="stringliteral">&quot;kernel&quot;</span>, tmp_kernel);
<a name="l00488"></a>00488     opt_tmp-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a93430579dc5f429ccc16106a7e643b69" title="Adds a generic option to the list indexed with a specified key.">addOpt</a>(<span class="stringliteral">&quot;paramsel&quot;</span>, tmp_paramsel);
<a name="l00489"></a>00489     opt_tmp-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a93430579dc5f429ccc16106a7e643b69" title="Adds a generic option to the list indexed with a specified key.">addOpt</a>(<span class="stringliteral">&quot;optimizer&quot;</span>, tmp_optimizer);
<a name="l00490"></a>00490 
<a name="l00491"></a>00491     tmp_kernel-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a93430579dc5f429ccc16106a7e643b69" title="Adds a generic option to the list indexed with a specified key.">addOpt</a>(<span class="stringliteral">&quot;type&quot;</span>, opt-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#ad0d2298f85d7e89e810f5234b6e85abb" title="Returns a string option mapped with a key.">getOptAsString</a>(<span class="stringliteral">&quot;kernel.type&quot;</span>));
<a name="l00492"></a>00492     tmp_paramsel-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a93430579dc5f429ccc16106a7e643b69" title="Adds a generic option to the list indexed with a specified key.">addOpt</a>(<span class="stringliteral">&quot;sigma&quot;</span>, <span class="keyword">new</span> <a class="code" href="../../d9/d58/classgurls_1_1_opt_number.html" title="OptNumber is an option containing a double precision floating point number.">OptNumber</a>(sigma));
<a name="l00493"></a>00493 
<a name="l00494"></a>00494 
<a name="l00495"></a>00495     <a class="code" href="../../d3/dd7/classgurls_1_1_pred_kernel_train_test.html" title="PredKernelTrainTest is the sub-class of PredKernel that computes the kernel matrix between training a...">PredKernelTrainTest&lt;T&gt;</a> predKernelTask;
<a name="l00496"></a>00496 
<a name="l00497"></a>00497     <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> *alpha_mat = <span class="keyword">new</span> <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a>(guesses_end, t);
<a name="l00498"></a>00498     T *<span class="keyword">const</span> alpha = alpha_mat-&gt;<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>();
<a name="l00499"></a>00499 
<a name="l00500"></a>00500     <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;unsigned long&gt;</a> *guesses_mat = <span class="keyword">new</span> <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;unsigned long&gt;</a>(guesses.size(), 1);
<a name="l00501"></a>00501     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *guesses_mat_it = guesses_mat-&gt;<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>();
<a name="l00502"></a>00502     <span class="keyword">set</span>(guesses_mat_it, 0ul, guesses.size());
<a name="l00503"></a>00503 
<a name="l00504"></a>00504     boost::posix_time::ptime begin, end;
<a name="l00505"></a>00505     boost::posix_time::time_duration diff;
<a name="l00506"></a>00506 
<a name="l00507"></a>00507     begin = boost::posix_time::microsec_clock::local_time();
<a name="l00508"></a>00508     <span class="keywordflow">for</span>(std::vector&lt;unsigned long&gt;::iterator it = guesses.begin(); it != guesses.end(); ++it)
<a name="l00509"></a>00509     {
<a name="l00510"></a>00510         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> i = *it;
<a name="l00511"></a>00511         *guesses_mat_it = i+1;
<a name="l00512"></a>00512 
<a name="l00513"></a>00513 <span class="comment">//        Xnew = Xtr(indices(i_init:i_end),:);</span>
<a name="l00514"></a>00514         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> nindices = i - i_init + 1;
<a name="l00515"></a>00515         <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> *Xnew = <span class="keyword">new</span> <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a>(nindices,d);
<a name="l00516"></a>00516         <a class="code" href="../../db/d4e/namespacegurls.html#a4015e8417bc5f4375da5524d7b67338c" title="Generates a submatrix from an input matrix.">subMatrixFromRows</a>(Xtr-&gt;<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>(), ntr, d, indices+i_init, nindices, Xnew-&gt;<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>());
<a name="l00517"></a>00517 
<a name="l00518"></a>00518 <span class="comment">//        opt_tmp.rls.X = Xnew;</span>
<a name="l00519"></a>00519         tmp_optimizer-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a93430579dc5f429ccc16106a7e643b69" title="Adds a generic option to the list indexed with a specified key.">addOpt</a>(<span class="stringliteral">&quot;X&quot;</span>, <span class="keyword">new</span> <a class="code" href="../../de/d63/classgurls_1_1_opt_matrix.html" title="OptMatrix is an option containing a matrix.">OptMatrix</a>&lt;<a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> &gt;(*Xnew, <span class="keyword">false</span>));
<a name="l00520"></a>00520 
<a name="l00521"></a>00521 <span class="comment">//        kernel_col = predkernel_traintest(Xtr,[],opt_tmp);</span>
<a name="l00522"></a>00522         <a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html" title="GurlsOptionsList is an option containing a list of options mapped by name.">GurlsOptionsList</a> *kernel = predKernelTask.<a class="code" href="../../d3/dd7/classgurls_1_1_pred_kernel_train_test.html#ad9ea7a49b769e20aada15fb1d7a4f0e4" title="Computes the kernel matrix between the training set and the test set X, in order to predict the label...">execute</a>(*Xtr, empty, *opt_tmp);
<a name="l00523"></a>00523 
<a name="l00524"></a>00524         <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> &amp;predkernel_K = kernel-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a11e973e29694f9090d3d213e2bfa0632" title="Returns a reference to the value contained into an option mapped with a key.">getOptValue</a>&lt;<a class="code" href="../../de/d63/classgurls_1_1_opt_matrix.html" title="OptMatrix is an option containing a matrix.">OptMatrix&lt;gMat2D&lt;T&gt;</a> &gt; &gt;(<span class="stringliteral">&quot;K&quot;</span>);
<a name="l00525"></a>00525 
<a name="l00526"></a>00526 <span class="comment">//        Kty(i_init:i_end,:) = kernel_col.K&#39;*y;</span>
<a name="l00527"></a>00527         T* Kty_sub = <span class="keyword">new</span> T[nindices*t];
<a name="l00528"></a>00528         <a class="code" href="../../db/d4e/namespacegurls.html#afaec98de689dfb205e909e39158b4bf3" title="Implements the standard GEMM routine from Level3 BLAS General Matrix-Matrix multiplication of two sin...">dot</a>(predkernel_K.<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>(), ytr-&gt;<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>(), Kty_sub, ntr, nindices, ntr, t, nindices, t, CblasTrans, CblasNoTrans, CblasColMajor);
<a name="l00529"></a>00529         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> i=0; i&lt; t; ++i)
<a name="l00530"></a>00530             <a class="code" href="../../db/d4e/namespacegurls.html#acf8c56c7e1dddb56e5b6b65fcb817ded" title="Copies element form one vector to another one.">copy</a>(Kty+i_init+(i*guesses_end), Kty_sub+(i*nindices), nindices);
<a name="l00531"></a>00531 
<a name="l00532"></a>00532         <span class="keyword">delete</span> [] Kty_sub;
<a name="l00533"></a>00533 
<a name="l00534"></a>00534 <span class="comment">//        KtK(i_init:i_end,i_init:i_end) = kernel_col.K&#39;*kernel_col.K;</span>
<a name="l00535"></a>00535         T* KtK_sub = <span class="keyword">new</span> T[nindices*nindices];
<a name="l00536"></a>00536 
<a name="l00537"></a>00537         <a class="code" href="../../db/d4e/namespacegurls.html#afaec98de689dfb205e909e39158b4bf3" title="Implements the standard GEMM routine from Level3 BLAS General Matrix-Matrix multiplication of two sin...">dot</a>(predkernel_K.<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>(), predkernel_K.<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>(), KtK_sub, ntr, nindices, ntr, nindices, nindices, nindices, CblasTrans, CblasNoTrans, CblasColMajor);
<a name="l00538"></a>00538         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> i=0; i&lt; nindices; ++i)
<a name="l00539"></a>00539             <a class="code" href="../../db/d4e/namespacegurls.html#acf8c56c7e1dddb56e5b6b65fcb817ded" title="Copies element form one vector to another one.">copy</a>(KtK+i_init+((i_init+i)*guesses_end), KtK_sub+(i*nindices), nindices);
<a name="l00540"></a>00540 
<a name="l00541"></a>00541         <span class="keyword">delete</span>[] KtK_sub;
<a name="l00542"></a>00542 
<a name="l00543"></a>00543 
<a name="l00544"></a>00544 <span class="comment">//        if guesses_c&gt;1</span>
<a name="l00545"></a>00545         <span class="keywordflow">if</span>(it != guesses.begin())
<a name="l00546"></a>00546         {
<a name="l00547"></a>00547 <span class="comment">//            KtKcol = zeros((i_init-1),i_end-i_init+1);</span>
<a name="l00548"></a>00548             T *KtKcol = <span class="keyword">new</span> T[i_init*nindices];
<a name="l00549"></a>00549             <span class="keyword">set</span>(KtKcol, (T)0.0, i_init*nindices);
<a name="l00550"></a>00550 
<a name="l00551"></a>00551 
<a name="l00552"></a>00552             <span class="keyword">const</span> T salpha = (T)(-1.0/pow(sigma, 2));
<a name="l00553"></a>00553             <span class="keyword">const</span> T one = (T) 1.0;
<a name="l00554"></a>00554 
<a name="l00555"></a>00555             T *kernel_old = <span class="keyword">new</span> T[i_init];
<a name="l00556"></a>00556 
<a name="l00557"></a>00557             <span class="keyword">const</span> T *Xtr_it = Xtr-&gt;<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>();
<a name="l00558"></a>00558             T *K_it = predkernel_K.<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>();
<a name="l00559"></a>00559 
<a name="l00560"></a>00560 <span class="comment">//            for l=1:ntot</span>
<a name="l00561"></a>00561             <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> l = 0; l&lt; ntr; ++l, ++Xtr_it, ++K_it)
<a name="l00562"></a>00562             {
<a name="l00563"></a>00563 <span class="comment">//                opt_tmp.rls.X = Xsub(1:(i_init-1),:);</span>
<a name="l00564"></a>00564 <span class="comment">//                kernel_old = predkernel_traintest(X(l,:),[],opt_tmp);</span>
<a name="l00565"></a>00565                 <a class="code" href="../../db/d4e/namespacegurls.html#a2f5abe81f955fe01b9c78e369a9f1264" title="Utility function used to build the kernel matrix; it computes the matrix of the squared euclidean dis...">distance_transposed_vm</a>(Xtr_it, Xsub, d, guesses_end, kernel_old, i_init, ntr);
<a name="l00566"></a>00566                 <a class="code" href="../../db/d4e/namespacegurls.html#a82615df00122dfb0d589a5a245d612be" title="Template function to call BLAS *SCAL routines.">scal</a>(i_init, salpha, kernel_old, 1);
<a name="l00567"></a>00567                 <a class="code" href="../../db/d4e/namespacegurls.html#a4d9ac407d614639d9fe776fca148585b" title="In place computation of the exponential for each element of a vector.">exp</a>(kernel_old, i_init);
<a name="l00568"></a>00568 
<a name="l00569"></a>00569 <span class="comment">//                KtKcol = KtKcol + kernel_old.K&#39;*kernel_col.K(l,:);</span>
<a name="l00570"></a>00570                 <a class="code" href="../../db/d4e/namespacegurls.html#a140be15552f45a4f51b167b60cd636b4" title="Template function to call BLAS *GEMV routines.">gemv</a>(CblasNoTrans, i_init, 1, one, kernel_old, i_init, K_it, ntr, one, KtKcol, 1); <span class="comment">// 1 i_init   1 nindices  i_init nindices</span>
<a name="l00571"></a>00571             }
<a name="l00572"></a>00572 
<a name="l00573"></a>00573             <span class="keyword">delete</span> [] kernel_old;
<a name="l00574"></a>00574 
<a name="l00575"></a>00575 
<a name="l00576"></a>00576 <span class="comment">//            KtK(1:(i_init-1),i_init:i_end) = KtKcol;</span>
<a name="l00577"></a>00577 <span class="comment">//            KtK(i_init:i_end,1:(i_init-1)) = KtKcol&#39;;</span>
<a name="l00578"></a>00578             <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> j=0; j&lt;nindices; ++j)
<a name="l00579"></a>00579             {
<a name="l00580"></a>00580                 <a class="code" href="../../db/d4e/namespacegurls.html#acf8c56c7e1dddb56e5b6b65fcb817ded" title="Copies element form one vector to another one.">copy</a>(KtK+(guesses_end*(i_init+j)), KtKcol+(i_init*j), i_init);
<a name="l00581"></a>00581                 <a class="code" href="../../db/d4e/namespacegurls.html#acf8c56c7e1dddb56e5b6b65fcb817ded" title="Copies element form one vector to another one.">copy</a>(KtK+i_init+j, KtKcol+(i_init*j), i_init, guesses_end, 1);
<a name="l00582"></a>00582             }
<a name="l00583"></a>00583 
<a name="l00584"></a>00584             <span class="keyword">delete</span> [] KtKcol;
<a name="l00585"></a>00585         }
<a name="l00586"></a>00586 
<a name="l00587"></a>00587         <span class="keyword">delete</span> kernel;
<a name="l00588"></a>00588 
<a name="l00589"></a>00589 
<a name="l00590"></a>00590 <span class="comment">//        alpha = pinv(KtK(1:i_end,1:i_end))*(Kty(1:i_end,:));</span>
<a name="l00591"></a>00591 
<a name="l00592"></a>00592         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> ii = i+1;
<a name="l00593"></a>00593 
<a name="l00594"></a>00594         KtK_sub = <span class="keyword">new</span> T[ ii*ii];
<a name="l00595"></a>00595         <span class="keywordflow">for</span>(T *K_it = KtK, *Ks_it = KtK_sub, *<span class="keyword">const</span> K_end = K_it+(guesses_end*ii); K_it != K_end; K_it+=guesses_end, Ks_it+=ii)
<a name="l00596"></a>00596             <a class="code" href="../../db/d4e/namespacegurls.html#acf8c56c7e1dddb56e5b6b65fcb817ded" title="Copies element form one vector to another one.">copy</a>(Ks_it, K_it, ii);
<a name="l00597"></a>00597 
<a name="l00598"></a>00598         <span class="keywordtype">int</span> r, c;
<a name="l00599"></a>00599         T *pinv_K = <a class="code" href="../../db/d4e/namespacegurls.html#a753b9fab2b7733245db71f4d59bcfc9b" title="Computes the pseudo-inverse of a non square matrix A.">pinv</a>(KtK_sub, ii, ii, r, c);
<a name="l00600"></a>00600         <span class="keyword">delete</span> [] KtK_sub;
<a name="l00601"></a>00601 
<a name="l00602"></a>00602         Kty_sub = <span class="keyword">new</span> T[ii*t];
<a name="l00603"></a>00603         <span class="keywordflow">for</span>(T *K_it = Kty, *Ks_it = Kty_sub, *<span class="keyword">const</span> K_end = K_it+(guesses_end*t); K_it != K_end; K_it+=guesses_end, Ks_it+=ii)
<a name="l00604"></a>00604             <a class="code" href="../../db/d4e/namespacegurls.html#acf8c56c7e1dddb56e5b6b65fcb817ded" title="Copies element form one vector to another one.">copy</a>(Ks_it, K_it, ii);
<a name="l00605"></a>00605 
<a name="l00606"></a>00606 
<a name="l00607"></a>00607         <a class="code" href="../../db/d4e/namespacegurls.html#afaec98de689dfb205e909e39158b4bf3" title="Implements the standard GEMM routine from Level3 BLAS General Matrix-Matrix multiplication of two sin...">dot</a>(pinv_K, Kty_sub, alpha, ii, ii, ii, t, ii, t, CblasNoTrans, CblasNoTrans, CblasColMajor);
<a name="l00608"></a>00608 
<a name="l00609"></a>00609         <span class="keyword">delete</span> [] Kty_sub;
<a name="l00610"></a>00610         <span class="keyword">delete</span> [] pinv_K;
<a name="l00611"></a>00611 
<a name="l00612"></a>00612 
<a name="l00613"></a>00613         tmp_optimizer-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a7197b056bb30449f518a43cb564ec011" title="Removes the option mapped with a specified key.">removeOpt</a>(<span class="stringliteral">&quot;X&quot;</span>);
<a name="l00614"></a>00614 
<a name="l00615"></a>00615 <span class="comment">//        Xsub(i_init:i_end,:) = Xnew;</span>
<a name="l00616"></a>00616         <span class="keywordflow">for</span>(T* Xsub_it = Xsub+i_init, *Xsub_end = Xsub_it+(guesses_end*d), *Xnew_it = Xnew-&gt;<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>(); Xsub_it != Xsub_end; Xsub_it+=guesses_end, Xnew_it+=nindices)
<a name="l00617"></a>00617             <a class="code" href="../../db/d4e/namespacegurls.html#acf8c56c7e1dddb56e5b6b65fcb817ded" title="Copies element form one vector to another one.">copy</a>(Xsub_it, Xnew_it, nindices);
<a name="l00618"></a>00618 
<a name="l00619"></a>00619         <span class="keyword">delete</span> Xnew;
<a name="l00620"></a>00620 
<a name="l00621"></a>00621 <span class="comment">//        i_init = i_end+1;</span>
<a name="l00622"></a>00622         i_init = i+1;
<a name="l00623"></a>00623 
<a name="l00624"></a>00624         end = boost::posix_time::microsec_clock::local_time();
<a name="l00625"></a>00625         diff = end-begin;
<a name="l00626"></a>00626 
<a name="l00627"></a>00627         *times_it = <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">long</span><span class="keyword">&gt;</span>(diff.total_milliseconds());
<a name="l00628"></a>00628         ++times_it;
<a name="l00629"></a>00629 
<a name="l00630"></a>00630         ++guesses_mat_it;
<a name="l00631"></a>00631     }
<a name="l00632"></a>00632 
<a name="l00633"></a>00633 
<a name="l00634"></a>00634     <span class="keyword">delete</span> [] indices;
<a name="l00635"></a>00635     <span class="keyword">delete</span> [] KtK;
<a name="l00636"></a>00636     <span class="keyword">delete</span> [] Kty;
<a name="l00637"></a>00637 
<a name="l00638"></a>00638     <span class="keyword">delete</span> opt_tmp;
<a name="l00639"></a>00639 
<a name="l00640"></a>00640 
<a name="l00641"></a>00641 <span class="comment">//    vout.X = Xsub(1:i_end,:);</span>
<a name="l00642"></a>00642     paramsel-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a93430579dc5f429ccc16106a7e643b69" title="Adds a generic option to the list indexed with a specified key.">addOpt</a>(<span class="stringliteral">&quot;X&quot;</span>, <span class="keyword">new</span> <a class="code" href="../../de/d63/classgurls_1_1_opt_matrix.html" title="OptMatrix is an option containing a matrix.">OptMatrix</a>&lt;<a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> &gt;(*Xsub_mat));
<a name="l00643"></a>00643 
<a name="l00644"></a>00644 <span class="comment">//    vout.C = alpha;</span>
<a name="l00645"></a>00645     paramsel-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a93430579dc5f429ccc16106a7e643b69" title="Adds a generic option to the list indexed with a specified key.">addOpt</a>(<span class="stringliteral">&quot;C&quot;</span>, <span class="keyword">new</span> <a class="code" href="../../de/d63/classgurls_1_1_opt_matrix.html" title="OptMatrix is an option containing a matrix.">OptMatrix</a>&lt;<a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> &gt;(*alpha_mat));
<a name="l00646"></a>00646 
<a name="l00647"></a>00647 <span class="comment">//    vout.guesses = guesses;</span>
<a name="l00648"></a>00648     paramsel-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a93430579dc5f429ccc16106a7e643b69" title="Adds a generic option to the list indexed with a specified key.">addOpt</a>(<span class="stringliteral">&quot;guesses&quot;</span>, <span class="keyword">new</span> <a class="code" href="../../de/d63/classgurls_1_1_opt_matrix.html" title="OptMatrix is an option containing a matrix.">OptMatrix</a>&lt;<a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;unsigned long&gt;</a> &gt;(*guesses_mat));
<a name="l00649"></a>00649 
<a name="l00650"></a>00650 }
<a name="l00651"></a>00651 
<a name="l00652"></a>00652 
<a name="l00653"></a>00653 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;
<a name="l00654"></a><a class="code" href="../../d2/d25/classgurls_1_1_nystrom_wrapper.html#af474b1de2a83fc66a3970a70c1405b60">00654</a> <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a>* <a class="code" href="../../d2/d25/classgurls_1_1_nystrom_wrapper.html#af474b1de2a83fc66a3970a70c1405b60" title="Estimates label for an input matrix.">NystromWrapper&lt;T&gt;::eval</a>(<span class="keyword">const</span> <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> &amp;X)
<a name="l00655"></a>00655 {
<a name="l00656"></a>00656     <a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html" title="GurlsOptionsList is an option containing a list of options mapped by name.">GurlsOptionsList</a> *opt = this-&gt;opt;
<a name="l00657"></a>00657     <span class="keyword">const</span> <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> &amp;alpha_mat = opt-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a11e973e29694f9090d3d213e2bfa0632" title="Returns a reference to the value contained into an option mapped with a key.">getOptValue</a>&lt;<a class="code" href="../../de/d63/classgurls_1_1_opt_matrix.html" title="OptMatrix is an option containing a matrix.">OptMatrix&lt;gMat2D&lt;T&gt;</a> &gt; &gt;(<span class="stringliteral">&quot;paramsel.C&quot;</span>);
<a name="l00658"></a>00658     <span class="keyword">const</span> <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> &amp;X_mat = opt-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a11e973e29694f9090d3d213e2bfa0632" title="Returns a reference to the value contained into an option mapped with a key.">getOptValue</a>&lt;<a class="code" href="../../de/d63/classgurls_1_1_opt_matrix.html" title="OptMatrix is an option containing a matrix.">OptMatrix&lt;gMat2D&lt;T&gt;</a> &gt; &gt;(<span class="stringliteral">&quot;paramsel.X&quot;</span>);
<a name="l00659"></a>00659 
<a name="l00660"></a>00660 
<a name="l00661"></a>00661     <span class="keyword">const</span> T *<span class="keyword">const</span> alpha = alpha_mat.<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>();
<a name="l00662"></a>00662 
<a name="l00663"></a>00663     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> n = X.<a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html#a5ef176755f75f33e282fc1ac976958da" title="Returns the number of rows.">rows</a>();
<a name="l00664"></a>00664     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> t = alpha_mat.<a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html#afa235cd07be1afe30497d55c90c42844" title="Returns the number of columns.">cols</a>();
<a name="l00665"></a>00665     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> n_nystrom = X_mat.rows();
<a name="l00666"></a>00666 
<a name="l00667"></a>00667     <a class="code" href="../../d3/dd7/classgurls_1_1_pred_kernel_train_test.html" title="PredKernelTrainTest is the sub-class of PredKernel that computes the kernel matrix between training a...">PredKernelTrainTest&lt;T&gt;</a> predKernelTask;
<a name="l00668"></a>00668 
<a name="l00669"></a>00669     <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> empty;
<a name="l00670"></a>00670 
<a name="l00671"></a>00671 
<a name="l00672"></a>00672     <a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html" title="GurlsOptionsList is an option containing a list of options mapped by name.">GurlsOptionsList</a>* opt_tmp = <span class="keyword">new</span> <a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html" title="GurlsOptionsList is an option containing a list of options mapped by name.">GurlsOptionsList</a>(<span class="stringliteral">&quot;tmp&quot;</span>);
<a name="l00673"></a>00673     <a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html" title="GurlsOptionsList is an option containing a list of options mapped by name.">GurlsOptionsList</a>* tmp_kernel = <span class="keyword">new</span> <a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html" title="GurlsOptionsList is an option containing a list of options mapped by name.">GurlsOptionsList</a>(<span class="stringliteral">&quot;kernel&quot;</span>);
<a name="l00674"></a>00674     <a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html" title="GurlsOptionsList is an option containing a list of options mapped by name.">GurlsOptionsList</a>* tmp_paramsel = <span class="keyword">new</span> <a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html" title="GurlsOptionsList is an option containing a list of options mapped by name.">GurlsOptionsList</a>(<span class="stringliteral">&quot;paramsel&quot;</span>);
<a name="l00675"></a>00675     <a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html" title="GurlsOptionsList is an option containing a list of options mapped by name.">GurlsOptionsList</a>* tmp_optimizer = <span class="keyword">new</span> <a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html" title="GurlsOptionsList is an option containing a list of options mapped by name.">GurlsOptionsList</a>(<span class="stringliteral">&quot;optimizer&quot;</span>);
<a name="l00676"></a>00676 
<a name="l00677"></a>00677     opt_tmp-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a93430579dc5f429ccc16106a7e643b69" title="Adds a generic option to the list indexed with a specified key.">addOpt</a>(<span class="stringliteral">&quot;kernel&quot;</span>, tmp_kernel);
<a name="l00678"></a>00678     opt_tmp-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a93430579dc5f429ccc16106a7e643b69" title="Adds a generic option to the list indexed with a specified key.">addOpt</a>(<span class="stringliteral">&quot;paramsel&quot;</span>, tmp_paramsel);
<a name="l00679"></a>00679     opt_tmp-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a93430579dc5f429ccc16106a7e643b69" title="Adds a generic option to the list indexed with a specified key.">addOpt</a>(<span class="stringliteral">&quot;optimizer&quot;</span>, tmp_optimizer);
<a name="l00680"></a>00680 
<a name="l00681"></a>00681     tmp_kernel-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a93430579dc5f429ccc16106a7e643b69" title="Adds a generic option to the list indexed with a specified key.">addOpt</a>(<span class="stringliteral">&quot;type&quot;</span>, opt-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#ad0d2298f85d7e89e810f5234b6e85abb" title="Returns a string option mapped with a key.">getOptAsString</a>(<span class="stringliteral">&quot;kernel.type&quot;</span>));
<a name="l00682"></a>00682     tmp_paramsel-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a93430579dc5f429ccc16106a7e643b69" title="Adds a generic option to the list indexed with a specified key.">addOpt</a>(<span class="stringliteral">&quot;sigma&quot;</span>, <span class="keyword">new</span> <a class="code" href="../../d9/d58/classgurls_1_1_opt_number.html" title="OptNumber is an option containing a double precision floating point number.">OptNumber</a>(opt-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a45c4d02344b2c83c3641f4b41034e320" title="Returns a numeric option mapped with a key.">getOptAsNumber</a>(<span class="stringliteral">&quot;paramsel.sigma&quot;</span>)));
<a name="l00683"></a>00683     tmp_optimizer-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a93430579dc5f429ccc16106a7e643b69" title="Adds a generic option to the list indexed with a specified key.">addOpt</a>(<span class="stringliteral">&quot;X&quot;</span>, opt-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a2706778db0c0e9e4274a5c149936fb69" title="Returns a pointer to a generic option mapped with a key.">getOpt</a>(<span class="stringliteral">&quot;paramsel.X&quot;</span>));
<a name="l00684"></a>00684 
<a name="l00685"></a>00685     <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> *y = <span class="keyword">new</span> <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a>(n, t);
<a name="l00686"></a>00686 
<a name="l00687"></a>00687     <a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html" title="GurlsOptionsList is an option containing a list of options mapped by name.">GurlsOptionsList</a> *predKernel = predKernelTask.<a class="code" href="../../d3/dd7/classgurls_1_1_pred_kernel_train_test.html#ad9ea7a49b769e20aada15fb1d7a4f0e4" title="Computes the kernel matrix between the training set and the test set X, in order to predict the label...">execute</a>(X, empty, *opt_tmp);
<a name="l00688"></a>00688     <span class="keyword">const</span> <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> &amp;predKernel_K = predKernel-&gt;getOptValue&lt;<a class="code" href="../../de/d63/classgurls_1_1_opt_matrix.html" title="OptMatrix is an option containing a matrix.">OptMatrix&lt;gMat2D&lt;T&gt;</a> &gt; &gt;(<span class="stringliteral">&quot;K&quot;</span>);
<a name="l00689"></a>00689 
<a name="l00690"></a>00690     <a class="code" href="../../db/d4e/namespacegurls.html#afaec98de689dfb205e909e39158b4bf3" title="Implements the standard GEMM routine from Level3 BLAS General Matrix-Matrix multiplication of two sin...">dot</a>(predKernel_K.<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>(), alpha, y-&gt;<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>(), n, n_nystrom, n_nystrom, t, n, t, CblasNoTrans, CblasNoTrans, CblasColMajor);
<a name="l00691"></a>00691 
<a name="l00692"></a>00692     tmp_optimizer-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a7197b056bb30449f518a43cb564ec011" title="Removes the option mapped with a specified key.">removeOpt</a>(<span class="stringliteral">&quot;X&quot;</span>, <span class="keyword">false</span>);
<a name="l00693"></a>00693 
<a name="l00694"></a>00694     <span class="keyword">delete</span> opt_tmp;
<a name="l00695"></a>00695     <span class="keyword">delete</span> predKernel;
<a name="l00696"></a>00696 
<a name="l00697"></a>00697     <span class="keywordflow">return</span> y;
<a name="l00698"></a>00698 }
<a name="l00699"></a>00699 
<a name="l00700"></a>00700 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;
<a name="l00701"></a><a class="code" href="../../d2/d25/classgurls_1_1_nystrom_wrapper.html#aa5b2a0bd7596852bf144c7049a3cfdf4">00701</a> <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a>* <a class="code" href="../../d2/d25/classgurls_1_1_nystrom_wrapper.html#aa5b2a0bd7596852bf144c7049a3cfdf4" title="Estimates label for an input matrix, optimized for large_scale data.">NystromWrapper&lt;T&gt;::eval_largescale</a>(<span class="keyword">const</span> <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> &amp;X)
<a name="l00702"></a>00702 {
<a name="l00703"></a>00703     <a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html" title="GurlsOptionsList is an option containing a list of options mapped by name.">GurlsOptionsList</a> *opt = this-&gt;opt;
<a name="l00704"></a>00704     <span class="keyword">const</span> <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> &amp;alpha_mat = opt-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a11e973e29694f9090d3d213e2bfa0632" title="Returns a reference to the value contained into an option mapped with a key.">getOptValue</a>&lt;<a class="code" href="../../de/d63/classgurls_1_1_opt_matrix.html" title="OptMatrix is an option containing a matrix.">OptMatrix&lt;gMat2D&lt;T&gt;</a> &gt; &gt;(<span class="stringliteral">&quot;paramsel.alpha&quot;</span>);
<a name="l00705"></a>00705     <span class="keyword">const</span> <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> &amp;X_mat = opt-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a11e973e29694f9090d3d213e2bfa0632" title="Returns a reference to the value contained into an option mapped with a key.">getOptValue</a>&lt;<a class="code" href="../../de/d63/classgurls_1_1_opt_matrix.html" title="OptMatrix is an option containing a matrix.">OptMatrix&lt;gMat2D&lt;T&gt;</a> &gt; &gt;(<span class="stringliteral">&quot;paramsel.X&quot;</span>);
<a name="l00706"></a>00706     <span class="keyword">const</span> T *<span class="keyword">const</span> alpha = alpha_mat.<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>();
<a name="l00707"></a>00707 
<a name="l00708"></a>00708     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> n = X.<a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html#a5ef176755f75f33e282fc1ac976958da" title="Returns the number of rows.">rows</a>();
<a name="l00709"></a>00709     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> d = X.<a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html#afa235cd07be1afe30497d55c90c42844" title="Returns the number of columns.">cols</a>();
<a name="l00710"></a>00710     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> t = alpha_mat.<a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html#afa235cd07be1afe30497d55c90c42844" title="Returns the number of columns.">cols</a>();
<a name="l00711"></a>00711     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> n_nystrom = X_mat.rows();
<a name="l00712"></a>00712 
<a name="l00713"></a>00713     <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> Xi_mat(1, d);
<a name="l00714"></a>00714     T* yi = <span class="keyword">new</span> T[t];
<a name="l00715"></a>00715     T* <span class="keyword">const</span> Xi = Xi_mat.<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>();
<a name="l00716"></a>00716 
<a name="l00717"></a>00717     <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> *y_mat = <span class="keyword">new</span> <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a>(n, t);
<a name="l00718"></a>00718     T* y_it = y_mat-&gt;<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>();
<a name="l00719"></a>00719 
<a name="l00720"></a>00720     <a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html" title="GurlsOptionsList is an option containing a list of options mapped by name.">GurlsOptionsList</a>* opt_tmp = <span class="keyword">new</span> <a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html" title="GurlsOptionsList is an option containing a list of options mapped by name.">GurlsOptionsList</a>(<span class="stringliteral">&quot;tmp&quot;</span>);
<a name="l00721"></a>00721     <a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html" title="GurlsOptionsList is an option containing a list of options mapped by name.">GurlsOptionsList</a>* tmp_kernel = <span class="keyword">new</span> <a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html" title="GurlsOptionsList is an option containing a list of options mapped by name.">GurlsOptionsList</a>(<span class="stringliteral">&quot;kernel&quot;</span>);
<a name="l00722"></a>00722     <a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html" title="GurlsOptionsList is an option containing a list of options mapped by name.">GurlsOptionsList</a>* tmp_paramsel = <span class="keyword">new</span> <a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html" title="GurlsOptionsList is an option containing a list of options mapped by name.">GurlsOptionsList</a>(<span class="stringliteral">&quot;paramsel&quot;</span>);
<a name="l00723"></a>00723     <a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html" title="GurlsOptionsList is an option containing a list of options mapped by name.">GurlsOptionsList</a>* tmp_optimizer = <span class="keyword">new</span> <a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html" title="GurlsOptionsList is an option containing a list of options mapped by name.">GurlsOptionsList</a>(<span class="stringliteral">&quot;optimizer&quot;</span>);
<a name="l00724"></a>00724 
<a name="l00725"></a>00725     opt_tmp-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a93430579dc5f429ccc16106a7e643b69" title="Adds a generic option to the list indexed with a specified key.">addOpt</a>(<span class="stringliteral">&quot;kernel&quot;</span>, tmp_kernel);
<a name="l00726"></a>00726     opt_tmp-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a93430579dc5f429ccc16106a7e643b69" title="Adds a generic option to the list indexed with a specified key.">addOpt</a>(<span class="stringliteral">&quot;paramsel&quot;</span>, tmp_paramsel);
<a name="l00727"></a>00727     opt_tmp-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a93430579dc5f429ccc16106a7e643b69" title="Adds a generic option to the list indexed with a specified key.">addOpt</a>(<span class="stringliteral">&quot;optimizer&quot;</span>, tmp_optimizer);
<a name="l00728"></a>00728 
<a name="l00729"></a>00729     tmp_kernel-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a93430579dc5f429ccc16106a7e643b69" title="Adds a generic option to the list indexed with a specified key.">addOpt</a>(<span class="stringliteral">&quot;type&quot;</span>, opt-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#ad0d2298f85d7e89e810f5234b6e85abb" title="Returns a string option mapped with a key.">getOptAsString</a>(<span class="stringliteral">&quot;kernel.type&quot;</span>));
<a name="l00730"></a>00730     tmp_paramsel-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a93430579dc5f429ccc16106a7e643b69" title="Adds a generic option to the list indexed with a specified key.">addOpt</a>(<span class="stringliteral">&quot;sigma&quot;</span>, <span class="keyword">new</span> <a class="code" href="../../d9/d58/classgurls_1_1_opt_number.html" title="OptNumber is an option containing a double precision floating point number.">OptNumber</a>(opt-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a45c4d02344b2c83c3641f4b41034e320" title="Returns a numeric option mapped with a key.">getOptAsNumber</a>(<span class="stringliteral">&quot;sigma&quot;</span>)));
<a name="l00731"></a>00731     tmp_optimizer-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a93430579dc5f429ccc16106a7e643b69" title="Adds a generic option to the list indexed with a specified key.">addOpt</a>(<span class="stringliteral">&quot;X&quot;</span>, opt-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a2706778db0c0e9e4274a5c149936fb69" title="Returns a pointer to a generic option mapped with a key.">getOpt</a>(<span class="stringliteral">&quot;paramsel.X&quot;</span>));
<a name="l00732"></a>00732 
<a name="l00733"></a>00733 
<a name="l00734"></a>00734     <a class="code" href="../../d3/dd7/classgurls_1_1_pred_kernel_train_test.html" title="PredKernelTrainTest is the sub-class of PredKernel that computes the kernel matrix between training a...">PredKernelTrainTest&lt;T&gt;</a> predKernelTask;
<a name="l00735"></a>00735     <span class="keyword">const</span> <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> empty;
<a name="l00736"></a>00736 
<a name="l00737"></a>00737     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;n; ++i, ++y_it)
<a name="l00738"></a>00738     {
<a name="l00739"></a>00739         <a class="code" href="../../db/d4e/namespacegurls.html#ad7448a55e9fec1102f1716192fe11547" title="Generates a vector containing a copy of a row of an input matrix.">getRow</a>(X.<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>(), n, d, i, Xi);
<a name="l00740"></a>00740 
<a name="l00741"></a>00741         <a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html" title="GurlsOptionsList is an option containing a list of options mapped by name.">GurlsOptionsList</a> *predKernel = predKernelTask.<a class="code" href="../../d3/dd7/classgurls_1_1_pred_kernel_train_test.html#ad9ea7a49b769e20aada15fb1d7a4f0e4" title="Computes the kernel matrix between the training set and the test set X, in order to predict the label...">execute</a>(Xi_mat, empty, *opt_tmp);
<a name="l00742"></a>00742         <span class="keyword">const</span> <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a> &amp;predKernel_K = predKernel-&gt;getOptValue&lt;<a class="code" href="../../de/d63/classgurls_1_1_opt_matrix.html" title="OptMatrix is an option containing a matrix.">OptMatrix&lt;gMat2D&lt;T&gt;</a> &gt; &gt;(<span class="stringliteral">&quot;K&quot;</span>);
<a name="l00743"></a>00743 
<a name="l00744"></a>00744         <a class="code" href="../../db/d4e/namespacegurls.html#afaec98de689dfb205e909e39158b4bf3" title="Implements the standard GEMM routine from Level3 BLAS General Matrix-Matrix multiplication of two sin...">dot</a>(predKernel_K.<a class="code" href="../../d9/d8b/classgurls_1_1_base_array.html#a6bef0c3b86bdedcbc2886e8e4c2cbc16" title="Returns a const pointer to the vector buffer.">getData</a>(), alpha, yi, 1, n_nystrom, n_nystrom, t, 1, t, CblasNoTrans, CblasNoTrans, CblasColMajor);
<a name="l00745"></a>00745         <a class="code" href="../../db/d4e/namespacegurls.html#acf8c56c7e1dddb56e5b6b65fcb817ded" title="Copies element form one vector to another one.">copy</a>(y_it, yi, t, n, 1);
<a name="l00746"></a>00746 
<a name="l00747"></a>00747         <span class="keyword">delete</span> predKernel;
<a name="l00748"></a>00748     }
<a name="l00749"></a>00749 
<a name="l00750"></a>00750     tmp_optimizer-&gt;<a class="code" href="../../dc/d34/classgurls_1_1_gurls_options_list.html#a7197b056bb30449f518a43cb564ec011" title="Removes the option mapped with a specified key.">removeOpt</a>(<span class="stringliteral">&quot;X&quot;</span>, <span class="keyword">false</span>);
<a name="l00751"></a>00751     <span class="keyword">delete</span> opt_tmp;
<a name="l00752"></a>00752     <span class="keyword">delete</span> [] yi;
<a name="l00753"></a>00753 
<a name="l00754"></a>00754     <span class="keywordflow">return</span> y_mat;
<a name="l00755"></a>00755 }
<a name="l00756"></a>00756 
<a name="l00757"></a>00757 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;
<a name="l00758"></a><a class="code" href="../../d2/d25/classgurls_1_1_nystrom_wrapper.html#aa094580be9dc2dc749ddd8ca6cd5f7ea">00758</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/d25/classgurls_1_1_nystrom_wrapper.html#aa094580be9dc2dc749ddd8ca6cd5f7ea">NystromWrapper&lt;T&gt;::setParam</a>(<span class="keywordtype">double</span> value)
<a name="l00759"></a>00759 {
<a name="l00760"></a>00760     this-&gt;setNparams(1);
<a name="l00761"></a>00761 
<a name="l00762"></a>00762     <span class="keywordflow">if</span>(this-&gt;opt-&gt;hasOpt(<span class="stringliteral">&quot;n_nystrom&quot;</span>))
<a name="l00763"></a>00763         this-&gt;opt-&gt;template getOptValue&lt;OptNumber&gt;(<span class="stringliteral">&quot;n_nystrom&quot;</span>) = value;
<a name="l00764"></a>00764     <span class="keywordflow">else</span>
<a name="l00765"></a>00765         this-&gt;opt-&gt;addOpt(<span class="stringliteral">&quot;n_nystrom&quot;</span>, <span class="keyword">new</span> <a class="code" href="../../d9/d58/classgurls_1_1_opt_number.html" title="OptNumber is an option containing a double precision floating point number.">OptNumber</a>(value));
<a name="l00766"></a>00766 }
<a name="l00767"></a>00767 
<a name="l00768"></a>00768 <span class="comment">//template &lt;typename T&gt;</span>
<a name="l00769"></a>00769 <span class="comment">//void NystromWrapper&lt;T&gt;::rescale(gMat2D&lt;T&gt; &amp;y)</span>
<a name="l00770"></a>00770 <span class="comment">//{</span>
<a name="l00771"></a>00771 <span class="comment">//    const unsigned long n = y.rows();</span>
<a name="l00772"></a>00772 <span class="comment">//    const unsigned long t = y.cols();</span>
<a name="l00773"></a>00773 
<a name="l00774"></a>00774 <span class="comment">//    T* yt = new T[y.getSize()];</span>
<a name="l00775"></a>00775 
<a name="l00776"></a>00776 <span class="comment">//    transpose(y.getData(), n, t, yt);</span>
<a name="l00777"></a>00777 
<a name="l00778"></a>00778 
<a name="l00779"></a>00779 <span class="comment">//    //unsigned long counts[2] = {0, 0};</span>
<a name="l00780"></a>00780 <span class="comment">//    unsigned long *counts = new unsigned long [t];</span>
<a name="l00781"></a>00781 <span class="comment">//    set(counts, 0ul, t);</span>
<a name="l00782"></a>00782 
<a name="l00783"></a>00783 <span class="comment">//    unsigned long *maxIndices = new unsigned long [n];</span>
<a name="l00784"></a>00784 <span class="comment">//    unsigned long *m_it = maxIndices;</span>
<a name="l00785"></a>00785 
<a name="l00786"></a>00786 
<a name="l00787"></a>00787 <span class="comment">//    T *it = yt;</span>
<a name="l00788"></a>00788 <span class="comment">//    for(unsigned long i=0; i&lt;n; ++i, it+=t)</span>
<a name="l00789"></a>00789 <span class="comment">//    {</span>
<a name="l00790"></a>00790 <span class="comment">//        unsigned long mindex = std::max_element(it, it+t)-it;</span>
<a name="l00791"></a>00791 
<a name="l00792"></a>00792 <span class="comment">//        *m_it++ = mindex;</span>
<a name="l00793"></a>00793 <span class="comment">//        ++counts[mindex];</span>
<a name="l00794"></a>00794 <span class="comment">//    }</span>
<a name="l00795"></a>00795 
<a name="l00796"></a>00796 <span class="comment">//    delete [] yt;</span>
<a name="l00797"></a>00797 
<a name="l00798"></a>00798 <span class="comment">//    unsigned long *coeffs = new unsigned long [t];</span>
<a name="l00799"></a>00799 <span class="comment">//    set(coeffs, 0ul, t);</span>
<a name="l00800"></a>00800 <span class="comment">//    for(unsigned long i=0; i&lt;t; ++i)</span>
<a name="l00801"></a>00801 <span class="comment">//    {</span>
<a name="l00802"></a>00802 <span class="comment">//        for(unsigned long j=0; j&lt;t; ++j)</span>
<a name="l00803"></a>00803 <span class="comment">//            if(i!=j)</span>
<a name="l00804"></a>00804 <span class="comment">//                coeffs[i] += counts[j];</span>
<a name="l00805"></a>00805 <span class="comment">//    }</span>
<a name="l00806"></a>00806 
<a name="l00807"></a>00807 <span class="comment">//    it = y.getData();</span>
<a name="l00808"></a>00808 <span class="comment">//    m_it = maxIndices;</span>
<a name="l00809"></a>00809 
<a name="l00810"></a>00810 <span class="comment">//    for(unsigned long i=0; i&lt;n; ++i, ++it, ++m_it)</span>
<a name="l00812"></a>00812 <span class="comment"></span><span class="comment">//        scal(t, (T)(coeffs[*m_it]), it, n);</span>
<a name="l00813"></a>00813 
<a name="l00814"></a>00814 
<a name="l00815"></a>00815 <span class="comment">//    delete [] counts;</span>
<a name="l00816"></a>00816 <span class="comment">//    delete [] coeffs;</span>
<a name="l00817"></a>00817 
<a name="l00818"></a>00818 
<a name="l00819"></a>00819 <span class="comment">//    delete [] maxIndices;</span>
<a name="l00820"></a>00820 
<a name="l00821"></a>00821 <span class="comment">//}</span>
<a name="l00822"></a>00822 
<a name="l00823"></a>00823 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;
<a name="l00824"></a>00824 <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>* <a class="code" href="../../d2/d25/classgurls_1_1_nystrom_wrapper.html" title="NystromWrapper is the sub-class of GurlsWrapper that allows to train a possibly non linear model for ...">NystromWrapper&lt;T&gt;::getIndices</a>(<span class="keyword">const</span> <a class="code" href="../../d1/d9e/classgurls_1_1g_mat2_d.html" title="gMat2D implements a matrix of generic size">gMat2D&lt;T&gt;</a>&amp;y, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> n, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> t, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> n_nystrom, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> &amp;length)
<a name="l00825"></a>00825 {
<a name="l00826"></a>00826     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *indices = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>[n];
<a name="l00827"></a>00827     <a class="code" href="../../db/d4e/namespacegurls.html#a75f6afe3bf7f7be79d66714593f5c7bc" title="Generates a vector containing a random permutation of the values from start to start+n inclusive...">randperm</a>(n, indices, <span class="keyword">true</span>, 0);
<a name="l00828"></a>00828 
<a name="l00829"></a>00829     length = n;
<a name="l00830"></a>00830     <span class="keywordflow">return</span> indices;
<a name="l00831"></a>00831 }
<a name="l00832"></a>00832 
<a name="l00833"></a>00833 }
</pre></div></div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Friends</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><b>nystromwrapper.hpp</b>      </li>

    <li class="footer">Generated on Mon Jul 1 2013 13:25:36 for GURLS++ by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
